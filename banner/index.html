<!DOCTYPE html>
<html lang="ru">
<head>

<!-- http://primercss.io/ -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- <link rel="stylesheet" type="text/css" href="/css/main2.css" /> -->
<!-- http://bootstrap-3.ru/javascript.php -->
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
<link rel="stylesheet" type="text/css" href="css/bootstrap-yii.css" />
<link rel="stylesheet" type="text/css" href="css/jquery-ui.css" />
<link rel="stylesheet" type="text/css" href="css/TextareaDecorator.css" />
<link rel="stylesheet" type="text/css" href="css/main2.css" />
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery-ui.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/coffee-script.js"></script>
<script type="text/javascript" src="js/ect.min.js"></script>
<script type="text/javascript" src="js/xpath.js"></script>
<script type="text/javascript" src="js/bootstrap-dropdown-right.js"></script>
<script type="text/javascript" src="js/Parser.js"></script>
<script type="text/javascript" src="js/TextareaDecorator.js"></script>
<script type="text/javascript" src="js/Keybinder.js"></script>
<script type="text/javascript" src="js/jquery.tabby.js"></script>
<script type="text/javascript" src="js/ldtparser.js"></script>
<script type="text/javascript" src="js/jquery.ba-bbq.js"></script>

<!-- https://select2.github.io/ -->
<link href="js/select2/dist/css/select2.min.css" rel="stylesheet" />
<script src="js/select2/dist/js/select2.min.js"></script>

<!-- http://www.listjs.com/ -->
<script type="text/javascript" src="js/list.js"></script>

<!-- https://github.com/finom/vanillatree -->
<link href="js/vanillatree/vanillatree.css" rel="stylesheet" />
<script src="js/vanillatree/vanillatree.js"></script>

<title>Banner</title>


<style>
.extracted-items-container {
pointer-events: none;
background-color: rgba(0,0,0,0.8);
padding: 10px;
width: 400px;
box-shadow: 0px 0px 12px 0px rgba(0,0,0,1.0);
position: fixed;
left: 400px;
top: 30px;
}

#hovered-element-info {
font: 1.0em Helvetica,Arial,sans-serif;
color: white;
padding: 8px;
/*float: left;*/
background-color: rgba(0,0,0,0.8);
box-shadow: 0px 4px 6px 0px rgba(0,0,0,0.8);
margin-right: 15px;
/*display: none;*/
pointer-events: all;
/*max-width: 450px;*/
border-radius: 3px;
}
</style>
</head>

<body >

<div id="main">
	<div id="header">
	<div class="container-fluid">
		<div id="userinfo">prio@hotbox.ru&nbsp;&nbsp;|&nbsp;&nbsp;<a target="_blank" href="#/ru/docs">Документация</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="#/ru/site/logout">Выход</a>		</div>
		<div id="logo">
			<a href="#/ru/">
				<h1>Banners</h1>
			</a>
		</div>
	</div>	
	</div><!-- header -->
	<div class="container-fluid">
		
<div class="row-fluid">
<div class="container-fluid">
				<div id="site_list" class="grid-view">
					<table class="items table table-striped table-bordered table-condensed">
					<thead>
						<tr>
							<th class="sort" id="yw0_c0"><a href="/main?Scrapers_sort=id">ID<span class="caret"></span></a></th>
							<th class="sort" id="yw0_c1"><a href="/main?Scrapers_sort=name">Название сайта<span class="caret"></span></a></th>
							<th class="sort" id="yw0_c2"><a href="/main?Scrapers_sort=start_page">URL сайта<span class="caret"></span></a></th>
							<th class="sort" id="yw0_c3"><a href="/main?Scrapers_sort=dtmodified">Изменено<span class="caret"></span></a></th>
							<th class="button-column" id="yw0_c4"> <input type="text" class="search" placeholder="Search" /></th>
						</tr>
					</thead>
					<tbody class="list">
						<tr class="odd">
							<td class="id">959</td>
							<td class="name">test</td>
							<td class="url">http://actionpay.ru/ru/</td>
							<td class="date_edit" style="width: 180px;">08.12.2014, 17:26:18</td>
							<td style="width: 95px">
								<a style="margin-left: 5px;" class="edit" rel="tooltip" href="/edit/959" data-original-title="Редактировать"><i class="icon-edit"></i></a>
								<a style="margin-left: 5px;" class="delete" rel="tooltip" href="/main/delete/959" data-original-title="Удалить"><i class="icon-remove"></i></a>
							</td>
						</tr>
						<tr class="even">
							<td class="id">955</td>
							<td class="name">cpainfo</td>
							<td class="url">http://cpainform.ru/programs/funservices/santa4me/</td>
							<td class="date_edit" style="width: 180px;">12.12.2014, 18:56:27</td>
							<td style="width: 95px">
								<a style="margin-left: 5px;" class="edit" rel="tooltip" href="/edit/955" data-original-title="Редактировать"><i class="icon-edit"></i></a>
								<a style="margin-left: 5px;" class="delete" rel="tooltip" href="/main/delete/955" data-original-title="Удалить"><i class="icon-remove"></i></a>
							</td>
						</tr>
					</tbody>
					</table>
					<div class="keys" style="display:none" title="/main"><span>959</span><span>955</span></div>
				</div>
					<div class="span2">
						<div class="right-panel">
							<a href="/main/create"  class="create" rel="tooltip"  data-original-title="Create"><i class="icon-plus"></i>&nbsp;Добавить сайт</a>		
						</div>
						<div class="right-panel hint"></div>
					</div>
</div>				
</div>
</div>				

</div>			
<!-- DEL-->				
				<div id="deleteModal" class="modal fade" style="display: none;">
				<div class="modal-header">
					<a class="close" data-dismiss="modal">×</a>
					<h3>Удаление сайта</h3>
				</div>
				 <div class="modal-body">
					<p>Вы действительно хотите удалить <span class="js_site_name js_block_name js_code_name"></span>?</p>
				</div>
				 <div class="modal-footer">
					<a data-dismiss="modal" id="ok-del-btn" class="btn remove-item-btn js_del_site" href="/main/delete/955">OK</a>    <a data-dismiss="modal" id="cancel-del-btn" class="btn" href="#">Отмена</a></div>
				</div>
<!-- DEL-->
<!-- DEL BLOCK-->				
				<div id="deleteBlockModal" class="modal fade" style="display: none;">
				<div class="modal-header">
					<a class="close" data-dismiss="modal">×</a>
					<h3>Удаление сайта</h3>
				</div>
				 <div class="modal-body">
					<p>Вы действительно хотите удалить <span class="js_site_name js_block_name js_code_name"></span>?</p>
				</div>
				 <div class="modal-footer">
					<a data-dismiss="modal" id="ok-del-btn" class="btn remove-item-btn js_del_block" href="/main/delete/955">OK</a>    <a data-dismiss="modal" id="cancel-del-btn" class="btn" href="#">Отмена</a></div>
				</div>
<!-- DEL BLOCK-->
<!-- DEL CODE-->				
				<div id="deleteCodeModal" class="modal fade" style="display: none;">
				<div class="modal-header">
					<a class="close" data-dismiss="modal">×</a>
					<h3>Удаление сайта</h3>
				</div>
				 <div class="modal-body">
					<p>Вы действительно хотите удалить <span class="js_site_name js_block_name js_code_name"></span>?</p>
				</div>
				 <div class="modal-footer">
					<a data-dismiss="modal" id="ok-del-btn" class="btn remove-item-btn js_del_code" href="/main/delete/955">OK</a>    <a data-dismiss="modal" id="cancel-del-btn" class="btn" href="#">Отмена</a></div>
				</div>
<!-- DEL CODE-->

<!-- CREATE-->	
				<div id="createModal" class="modal fade" style="display: none;" >
					<div class="modal-header">
						<a class="close" data-dismiss="modal">×</a>
						<h3>Добавить сайт</h3>
					</div>
					<div class="modal-body">
						<form class="form1 form-vertical" id="form" action="/main/create" method="post"> 
						<fieldset>
							<label for="CreateScraperForm_name" class="required">Название сайта<span class="required">*</span></label>
							<input name="CreateScraperForm[name]" id="name-field" type="text">	
							<label for="CreateScraperForm_startpage" class="required">URL сайта <span class="required">*</span></label>
							<input style="width: 400px;" name="CreateScraperForm[startpage]" id="url-field" type="text">
						</fieldset>
						<br>
						</form>
					</div>
					<div class="modal-footer">
						<a data-dismiss="modal" id="add-btn" class="btn" href="/create/" >OK</a>    <a data-dismiss="modal" id="cancel-del-btn" class="btn" href="#">Отмена</a>
					</div>
				</div>
<!-- CREATE-->

<!-- CLOSE -->
<div id="closeModal" class="modal fade">
	<div class="modal-header">
		<a class="close" data-dismiss="modal">&times;</a>
		<h3>Закрытие</h3>
	</div>
	 
	<div class="modal-body">
		<p>Сохранить изменения?</p>
		<div class="popup3" style="margin-left: 45%; top: 40%;"><img src="img/ajax-loader2.gif" /></div>
	</div>
	 
	<div class="modal-footer">
		<a id="yes-close-btn" data-url="#/main" class="btn" href="#">Да</a>    
		<a data-dismiss="modal" id="no-close-btn" data-url="/main" class="btn" href="#">Нет</a>
		<a data-dismiss="modal" id="cancel-close-btn" class="btn" href="#">Отмена</a>
	</div>
</div>
<!-- CLOSE -->


<!-- EDIT-->
<style>
.list {
  font-family:sans-serif;
  margin:0;
  padding:20px 0 0;
}
.list > li {
  display:block;
  background-color: #eee;
  padding:10px;
  box-shadow: inset 0 1px 0 #fff;
}

</style>				
				<div id="editModal" class="modal fade"  style="display: none; margin: 0px; top: 0px;left:0px; width:100%;">
					<div class="modal-header">
						<a class="close" data-dismiss="modal">×</a>
						<h3 id = "js_name">Edit <span class="js_site_name"></span></h3>
					</div>
					<div class="modal-body" style="max-height:80%;">
						<fieldset>
							<label for="CreateScraperForm_name" class="required">Название сайта<span class="required">*</span></label>
							<input name="CreateScraperForm[name]" class="js_site_name" readonly type="text">	
							<label for="CreateScraperForm_startpage" class="required">URL сайта <span class="required">*</span></label>
							<input style="width: 400px;" name="CreateScraperForm[startpage]" readonly class="js_site_url" type="text">
						</fieldset>
						<div id="block_list" class="grid-view">
								<input type="text" class="search" placeholder="Search" />
								<ul class="list list-unstyled">
									<li class="">
										<span class="sort" id="yw0_c0" data-sort="id" style="width:200px;display: inline-block;"><a href="#/main?Scrapers_sort=id" >ID<span class="caret"></span></a></span>
										<span class="sort" id="yw0_c1" data-sort="name" style="width:200px;display: inline-block;"><a href="#/main?Scrapers_sort=name" >Блок<span class="caret"></span></a></span>
										<span class="button-column" id="yw0_c4" style="width:200px;display: inline-block;"> </span>
									</li>
								</ul>
						</div>
						
							<button id="additional-custom-block-button" class="btn green js_add_block" type="button">
								<i class="icon-add-white"></i>
								 Добавить блок
							</button>
							<div id="rules-right-btns">
								<div class="success">
									<img style="display: none;" src="img/ajax-loader2.gif" />
									<div></div>
								</div>
							</div>
							
							

					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal" onclick="siteclose();">Закрыть</button>
						<button type="button" class="btn btn-primary" onclick="sitesave();">Сохранить изменения</button>
					</div>
				</div>				
<!-- EDIT-->

<!-- BLOCK -->
					<div  id="blockModal" class="modal fade" style="display: none; margin: 0px; top: 0px;left:0px; width:100%;">
						<div class="modal-header">
							<a class="close" data-dismiss="modal">×</a>
							<h3 id = "js_name">Block <span class="js_block_name"></span></h3>
						</div>
						<div class="modal-body" style="max-height:80%;">
						
							<div class="pr20">
								<label for="title_input">Название блока <sup class="red">*</sup></label>
								<input type="text" id="title_input" name="title" class="red_text js_block_name" value="" required="required">
								<div class="error-message" id="title-check-error"></div>
							</div>
							<div style="clear:both;">
							<ul id="sidetabs" class="nav nav-tabs">
								<li class="active"><a id="tab-code" data-toggle="tab" href="#tabCode">Свой код</a></li>
								<li ><a id="tab-block"  data-toggle="tab" href="#tabBlock" >Тип блока</a></li>			
								<li><a id="tab-animation" data-toggle="tab" href="#tabAnimation">Анимация</a></li>
							</ul>
							
							<div class="tab-content">
								<div id="tabCode" class="tab-pane active">
									<div class="row block_box block_row highlight-box dimentions-box">
									<!-- Block size -->
									<div class="pull-right adv_block_sizes_help help_class" style="margin-right: 20px;" data-placement="top" data-trigger="hover" data-content="Настройте размеры рекламной области, которую выделили на сайте. В данной области через систему Advertone будут показываться все рекламные сети." data-original-title="" title=""></div>
									<div class="span39 design_box block_box">
										<p class="block-edit-form-label">Ширина блока</p>
										<div class="form-field mb5">
											<span>
												<div class="axis-size-inputs">
													<input class="template_block preview-input block-size-input js_block_horizontal" id="size_horizontal-input" type="text" name="size_horizontal" required="required" value="240px">
													<div class="error-message" id="size_horizontal-errmsg">
														
													</div>
													</div>
											  </span>
										</div>
									</div>
									<div class="span39 design_box block_box">
										<p class="block-edit-form-label">Высота блока</p>
										<div class="form-field mb5">
											<div class="axis-size-inputs">
												<input class="block-size-input template_block preview-input js_block_vertical" id="size_vertical-input" type="text" name="size_vertical" required="required" value="400px">
												<div class="error-message" id="size_vertical-errmsg">
												
												</div>
											</div>
										</div>
										
									</div>
									</div>
									
									<div id="code_list" class="grid-view">
											<input type="text" class="search" placeholder="Search" />
											<ul class="list list-unstyled">
												<li class="">
													<span class="sort" id="yw0_c0" data-sort="id" style="width:200px;display: inline-block;"><a href="#/main?Scrapers_sort=id" >ID<span class="caret"></span></a></span>
													<span class="sort" id="yw0_c1" data-sort="name" style="width:200px;display: inline-block;"><a href="#/main?Scrapers_sort=name" >Name Code<span class="caret"></span></a></span>
													<span class="button-column" id="yw0_c4" style="width:200px;display: inline-block;"> </span>
												</li>
											</ul>
									</div>
									<button id="additional-custom-block-button" class="btn green js_add_code" type="button">
										<i class="icon-add-white"></i>
										Еще один код
									</button>
									
								
								</div>
								
								
								<div id="tabBlock" class="tab-pane">Тип блока</div>
								<div id="tabAnimation" class="tab-pane">Анимация</div>
							</div>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
							<button type="button" class="btn btn-primary js_save_block">Сохранить изменения</button>
						</div>
					</div>
<!-- BLOCK -->

<!-- CODE -->
					<div  id="codeModal" class="modal fade" style="display: none; width:50%;">
						<div class="modal-header">
							<a class="close" data-dismiss="modal">×</a>
							<h3 id = "js_name">Code <span class="js_code_name"></span></h3>
						</div>
						<div class="modal-body" style="max-height:80%;">
									<div class="custom-block-form">
										<div class="custom-block-item " data-enum="1">
											<div>
												<label for="custom-block-title">Название <sup class="red">*</sup></label>
												<input class="custom-block-title js_code_name" id="custom-block-title" name="custom-block-title" type="text" value="">
												<div class="error-message">
													
												</div>
											</div>
											<div>
												<label for="custom-block-code" style="width: 590px">
													Код
													<div class="adv_codes_input_help code_help help_class" data-placement="top" data-trigger="hover" data-content="Вставьте код, который Вам выдала рекламная сеть. Обратите внимание на то, что если у рекламной сети 2 куска кода, то вставлять их нужно друг за другом, в любом порядке." data-original-title="" title="">
													</div>
												</label>
												<textarea class="nice-textarea custom-block-code custom_code valid js_code_code" id="custom-block-code" name="custom-block-code" rows="7" cols="250" spellcheck="false"></textarea>
												<div class="error-message">
													
												</div>
											</div>

										</div>
									</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
							<button type="button" class="btn btn-primary js_save_code">Сохранить изменения</button>
						</div>
					</div>
<!-- CODE -->

<script type="text/javascript" src="js/common.js" ></script>
<script type="text/javascript" >

if(!supports_html5_storage()){
	alert('обновите браузер');
}

var _BANNER = {
	sites: [],
	_name : null,
	_url : null,
	_block_name : null,
	_block_vertical : null,
	_block_horizontal : null,
	_code_name : null,
	_code_code: null,
	getSite : function(){
		for(var i in _BANNER.sites){
			if(_BANNER.sites[i].hasOwnProperty(_BANNER.name)){
				return _BANNER.sites[i][_BANNER.name];
			}
		}
		return {};
	},
	getBlock : function(){
		var site = _BANNER.getSite()['block'];
		for (var b in site){
			if(site[b].hasOwnProperty(_BANNER.block_name)){
				return site[b][_BANNER.block_name];
			}			
		}
		return {};
	},
	getCode: function(){
		var block = _BANNER.getBlock()['code'];
		for (var b in block){
			if(block[b].hasOwnProperty(_BANNER.code_name)){
				return block[b][_BANNER.code_name];
			}			
		}
		return {};
	}
};

bindModelInput(_BANNER,'name', document.querySelectorAll('.js_site_name'));
bindModelInput(_BANNER,'url', document.querySelectorAll('.js_site_url'));

bindModelInput(_BANNER,'block_name', document.querySelectorAll('.js_block_name'));
bindModelInput(_BANNER,'block_vertical', document.querySelectorAll('.js_block_vertical'));
bindModelInput(_BANNER,'block_horizontal', document.querySelectorAll('.js_block_horizontal'));


bindModelInput(_BANNER,'code_name', document.querySelectorAll('.js_code_name'));
bindModelInput(_BANNER, 'code_code', document.querySelectorAll('.js_code_code'));
bindModelInput(_BANNER,'id', null);

	//http://www.listjs.com/examples/add-get-remove
	/*************SITE****************/
function clearFieldsSite() {
	nameField.val('');
	urlField.val('');
}
function refreshCallbacksSite() {
	// Needed to add new buttons to jQuery-extended object
	removeBtns = $(removeBtns.selector);

	removeBtns.click(function() {
		var itemId = _BANNER.id;
		siteList.remove('id', itemId);
		//dellocalStorageParser(_PARSE.name);
		clearFieldsSite();
	});
	$('a.delete').click(function(e) {
		e.preventDefault();
		_BANNER.id = $(this).closest('tr').find('.id').text();
		_BANNER.name = $(this).closest('tr').find('.name').text();
		_BANNER.url = $(this).closest('tr').find('.url').text();
		
		$('#deleteModal').modal('show');
		//$('#deleteModal').find('#ok-del-btn').click(function(key){ console.log(_PARSE.name); dellocalStorageParser(key);});
	});	
	
	$('a.edit').click(function(e) {
		clearFieldsSite();
		e.preventDefault();
		_BANNER.id = $(this).closest('tr').find('.id').text();
		_BANNER.name = $(this).closest('tr').find('.name').text();
		_BANNER.url = $(this).closest('tr').find('.url').text();
		var site = {};
		site[_BANNER.name] = {
			'id' : _BANNER.id,
			'url' : _BANNER.url,
			'name' : _BANNER.name,
			'date_edit' : $(this).closest('tr').find('.date_edit').text(),
			'block' : []
		};
		for(var i in _BANNER.sites){
			if( _BANNER.sites[i].hasOwnProperty(_BANNER.name))
				delete _BANNER.sites[i];
		}
		_BANNER.sites.push(site);
		_BANNER.sites = _BANNER.sites.filter(function(a){return typeof a !== 'undefined';})
		//$('#editModal').addClass(' js_id_'+itemId);
		$('#editModal').modal('show');
	});

}
	var idField = $('#id-field');
	var nameField = $('#name-field');
	var urlField = $('#url-field');
	var removeBtns = $('.js_del_site');
	var addBtn = $('#add-btn');
	
	var SiteOptions = {
		valueNames: [ 'id', 'name', 'url', 'date_edit' ],
		//item: '<tr class="odd"><td class="id"></td><td class="name"></td><td class="url"></td><td class="date_edit" style="width: 180px;"></td><td style="width: 95px"><a style="margin-left: 5px;" class="edit" rel="tooltip" href="#" data-original-title="Редактировать"><i class="icon-edit"></i></a><a style="margin-left: 5px;" rel="tooltip" href="/generate/" data-original-title="Генерировать"><i class="icon-file"></i></a><a style="margin-left: 5px;" onclick="showRunDialog(this);" rel="tooltip" href="#" data-original-title="Управление запуском"><i class="icon-play"></i></a><a style="margin-left: 5px;" onclick="showResultDialog(this);" rel="tooltip" href="#" data-original-title="Результат выполнения"><i class="icon-folder-open"></i></a><a style="margin-left: 5px;" class="delete" rel="tooltip" href="#" data-original-title="Удалить"><i class="icon-remove"></i></a></td></tr>'
	};
	// Init list
	var siteList = new List('site_list', SiteOptions);
	refreshCallbacksSite();
	
	addBtn.click(function() {

		var id = Math.floor(Math.random()*110000);
		var url = urlField.val();
		var name = nameField.val();
		var date_edit = new Date().yyyymmdd();
		
		//var banner = getlocalStorageParser();
		var site = {};
		site[name] = {
			'id' : id,
			'url' : url,
			'name' : name,
			'date_edit' : date_edit,
			'block' : []
		};
		_BANNER.name = name;
		_BANNER.sites.push(site);
		siteList.add(site[name]);
		
		//setlocalStorageParser(parser); 	
		clearFieldsSite();
		refreshCallbacksSite();
	});
	
	
	
	
	$('a.create').click(function(e) {
		e.preventDefault();
		$('#createModal').modal('show');
	});
	

	
	/***********************BLOCK**************************/
	var BlockOptions = {
	  valueNames: [ 'id', 'name'],
	  item: '<li class=""><span class="id" style="width:200px;display: inline-block;"></span><span class="name" style="width:200px;display: inline-block;"></span><span style="width:200px;display: inline-block;"><a style="margin-left: 5px;" class="edit_block" rel="tooltip" href="/edit/955" data-original-title="Редактировать"><i class="icon-edit"></i></a><a style="margin-left: 5px;" class="del_block" rel="tooltip" href="/main/delete/955" data-original-title="Удалить"><i class="icon-remove"></i></a></span></li>'
	};
	// Init list
	var blockList = new List('block_list', BlockOptions);
	
	var blockName = $('#title_input');
	var blockVertical = $('#size_vertical-input');
	var blockHorizontal = $('#size_horizontal-input');
	var blockDel = $('.del_block');
	var blockEdit = $('.edit_block');
	var blockRemove = $('.js_del_block');

	
	function clearFieldsBlock() {
		blockName.val('');
		blockVertical.val('');
		blockHorizontal.val('');
		_BANNER.block_name = null;
		_BANNER.block_vertical = null;
		_BANNER.block_horizontal = null;
	}
	function refreshCallbacksBlock() {
		// Needed to add new buttons to jQuery-extended object

		blockRemove.click(function() {
			var itemId = _BANNER.getBlock()['id'];
			blockList.remove('id', itemId);
			//dellocalStorageParser(_PARSE.name);
			clearFieldsBlock();
		});
		
		 $('.del_block').click(function(e) {
			e.preventDefault();
			_BANNER.block_name = $(this).parent().parent().find('.name').text();
			$("#deleteBlockModal").css("z-index", "1051");
			$('#deleteBlockModal').modal('show');
			//$('#deleteModal').find('#ok-del-btn').click(function(key){ console.log(_PARSE.name); dellocalStorageParser(key);});
		});
		
		
		$('.edit_block').click(function(e) {
			clearFieldsBlock();
			e.preventDefault();
			_BANNER.block_name = $(this).parent().parent().find('.name').text();
			_BANNER.block_vertical = _BANNER.getBlock()['vertical'];
			_BANNER.block_horizontal = _BANNER.getBlock()['horizontal'];
			$('#blockModal').modal('show');
		});
	}


	$('.js_add_block').click(function(){
		_BANNER.block_name = null;
		$('#blockModal').modal('show');
	});

	function saveBlock(obj){
		var id = obj? obj['id'] : Math.floor(Math.random()*110000);
		var name = blockName.val();
		var horizontal = blockHorizontal.val();
		var vertical = blockVertical.val();
		
		var block = {};
		block[name] = {
			'id' : id,
			'name' : name,
			'horizontal' :horizontal,
			'vertical' : vertical,
			'code' : []
		};
		_BANNER.block_name = name;
		_BANNER.getSite()['block'].push(block);
		blockList.add(block[name]);
	}
	$('.js_save_block').click(function(){
	
		if( ! _BANNER.block_name ){
			saveBlock();
		}else{
			var block = blockList.get('id',  _BANNER.getBlock()['id'])[0];
			var _block = {};
			_block[blockName.val()] = {
				'id' :  _BANNER.getBlock()['id'],
				'name' : blockName.val(),
				'horizontal' :blockHorizontal.val(),
				'vertical' : blockVertical.val(),
				'code' : _BANNER.getBlock()['code']
			};
			block.values(_block[blockName.val()]);
			delete _BANNER.getBlock();
			_BANNER.block_name = name;
			_BANNER.getSite()['block'].push(_block);
		}
		clearFieldsBlock();
		refreshCallbacksBlock();
		$('#blockModal').modal('hide');
	});
	
	$('.js_add_code').click(function(e) {
		//document.querySelector('.custom-block-form').appendChild( createItem());
		if( ! _BANNER.block_name ){
			saveBlock();
		}
		if(!_BANNER.block_name){
			alert('Name block empty!!!');
		}else{
			clearFieldsCode();
			refreshCallbacksCode();
			$('#codeModal').modal('show');
		}
	});
	
	
	
	
	/********************CODE**********************/
	var CodeOptions = {
	  valueNames: [ 'id', 'name'],
	  item: '<li class=""><span class="id" style="width:200px;display: inline-block;"></span><span class="name" style="width:200px;display: inline-block;"></span><span style="width:200px;display: inline-block;"><a style="margin-left: 5px;" class="edit_code" rel="tooltip" href="/edit/955" data-original-title="Редактировать"><i class="icon-edit"></i></a><a style="margin-left: 5px;" class="del_code" rel="tooltip" href="/main/delete/955" data-original-title="Удалить"><i class="icon-remove"></i></a></span></li>'
	};
	// Init list
	var codeList = new List('code_list', CodeOptions);
	var codeName = $("#custom-block-title");
	var codeCode = $('#custom-block-code');
	var codeRemove = $('.js_del_code');
	
	$('.js_save_code').click(function(){
		if( ! _BANNER.code_name ){
			var id = Math.floor(Math.random()*110000);
			var name = codeName.val();
			var _code = codeCode.val();
			var code = {};
			code[name] = {
				'id' : id,
				'name' : name,
				'code' : _code
			};
			codeList.add(code[name]);
			
			_BANNER.getBlock()['code'].push(code);
			clearFieldsCode();
			refreshCallbacksCode();
			
		}else{
			var code = codeList.get('id',  _BANNER.getCode()['id'])[0];
			var _code = {};
			_code[codeName.val()] = {
				'id' :   _BANNER.getCode()['id'],
				'name' : codeName.val(),
				'code' : codeCode.val(),
			};
			code.values(_code[codeName.val()]);
			delete _BANNER.getCode();
			_BANNER.code_name = name;
			_BANNER.getBlock()['code'].push(_code);
			clearFieldsCode();
			refreshCallbacksCode();
		}
		$('#codeModal').modal('hide');
	});
	

	
function clearFieldsCode(){
	codeName.val('');
	codeCode.val('');
	_BANNER.code_name = null;
	_BANNER.code_code = null;
}
function refreshCallbacksCode() {
	// Needed to add new buttons to jQuery-extended object

	codeRemove.click(function() {
		var itemId = _BANNER.getCode()['id'];
		console.log(_BANNER.code_name);
		codeList.remove('id', itemId);
		//dellocalStorageParser(_PARSE.name);
		clearFieldsCode();
	});
	
	 $('.del_code').click(function(e) {
		e.preventDefault();
		_BANNER.code_name = $(this).parent().parent().find('.name').text();
		$("#deleteCodeModal").css("z-index", "1051");
		$('#deleteCodeModal').modal('show');
		//$('#deleteModal').find('#ok-del-btn').click(function(key){ console.log(_PARSE.name); dellocalStorageParser(key);});
	});
	
	
	$('.edit_code').click(function(e) {
		clearFieldsCode();
		e.preventDefault();
		_BANNER.code_name = $(this).parent().parent().find('.name').text();
		_BANNER.code_code = _BANNER.getCode()['code'];
		$('#codeModal').modal('show');
	});
}	
</script>
</body>
</html>