<!DOCTYPE html>
<html lang="ru">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<!-- <link rel="stylesheet" type="text/css" href="/css/main2.css" /> -->
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
<link rel="stylesheet" type="text/css" href="css/bootstrap-yii.css" />
<link rel="stylesheet" type="text/css" href="css/jquery-ui.css" />
<link rel="stylesheet" type="text/css" href="css/TextareaDecorator.css" />
<link rel="stylesheet" type="text/css" href="css/main2.css" />
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery-ui.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/coffee-script.js"></script>
<script type="text/javascript" src="js/ect.min.js"></script>
<script type="text/javascript" src="js/xpath.js"></script>
<script type="text/javascript" src="js/bootstrap-dropdown-right.js"></script>
<script type="text/javascript" src="js/Parser.js"></script>
<script type="text/javascript" src="js/TextareaDecorator.js"></script>
<script type="text/javascript" src="js/Keybinder.js"></script>
<script type="text/javascript" src="js/jquery.tabby.js"></script>
<script type="text/javascript" src="js/ldtparser.js"></script>
<script type="text/javascript" src="js/jquery.ba-bbq.js"></script>

<!-- http://www.listjs.com/ -->
<script type="text/javascript" src="js/list.js"></script>
<!-- https://github.com/finom/vanillatree -->
<link href="js/vanillatree/vanillatree.css" rel="stylesheet" />        
<script src="js/vanillatree/vanillatree.js"></script>
<script>
//http://javascript.ru/forum/dom-window/21288-nuzhna-pomoshh-s-ochen-prostymi-veshhami-3.html
jQuery.ajax = function (d) {
    var b = location.protocol,
        e = RegExp(b + "//" + location.hostname),
        f = "http" + (/^https/.test(b) ? "s" : "") + "://query.yahooapis.com/v1/public/yql?callback=?";
    return function (a) {
        var c = a.url;
        if (/get/i.test(a.type) && !/json/i.test(a.dataType) && !e.test(c) && /:\/\//.test(c)) {
            a.url = f;
            a.dataType = "json";
            a.data = {
                q: 'select * from html where url="{URL}" and xpath="*"'.replace("{URL}", c + (a.data ? (/\?/.test(c) ? "&" : "?") + jQuery.param(a.data) : "")),
                format: "xml"
            };
            !a.success && a.complete && (a.success = a.complete, delete a.complete);
            var b = a.success;
            a.success = function (a) {
                b && b.call(this, {
                    responseText: (a.results[0] || "").replace(/<script[^>]+?\/>|<script(.|\s)*?\/script>/gi, "")
                }, "success")
            }
        }
        return d.apply(this, arguments)
    }
}(jQuery.ajax);
</script>

<title>GET XPATH</title>


<style>
.extracted-items-container {
pointer-events: none;
background-color: rgba(0,0,0,0.8);
padding: 10px;
width: 400px;
box-shadow: 0px 0px 12px 0px rgba(0,0,0,1.0);
position: fixed;
left: 400px;
top: 30px;
}

#hovered-element-info {
font: 1.0em Helvetica,Arial,sans-serif;
color: white;
padding: 8px;
/*float: left;*/
background-color: rgba(0,0,0,0.8);
box-shadow: 0px 4px 6px 0px rgba(0,0,0,0.8);
margin-right: 15px;
/*display: none;*/
pointer-events: all;
/*max-width: 450px;*/
border-radius: 3px;
}
</style>
</head>

<body >

<div id="main">
	<div id="header">
	<div class="container-fluid">
		<div id="userinfo">prio@hotbox.ru&nbsp;&nbsp;|&nbsp;&nbsp;<a target="_blank" href="#/ru/docs">Документация</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="#/ru/site/logout">Выход</a>		</div>
		<div id="logo">
			<a href="#/ru/">
				<h1>ParserLab</h1>
			</a>
		</div>
	</div>	
	</div><!-- header -->
	
		
		
	<div class="container-fluid">
		
<div class="row-fluid">
			<div id="tabList" class="tab-pane active">
				<div class="container-fluid">
						
				<div class="row-fluid">
					<div class="span10">

				<div id="parser_list" class="grid-view">
					<table class="items table table-striped table-bordered table-condensed">
					<thead>
						<tr>
							<th class="sort" id="yw0_c0"><a href="/main?Scrapers_sort=id">ID<span class="caret"></span></a></th>
							<th class="sort" id="yw0_c1"><a href="/main?Scrapers_sort=name">Название<span class="caret"></span></a></th>
							<th class="sort" id="yw0_c2"><a href="/main?Scrapers_sort=start_page">Стартовая страница<span class="caret"></span></a></th>
							<th class="sort" id="yw0_c3"><a href="/main?Scrapers_sort=dtmodified">Изменено<span class="caret"></span></a></th>
							<th class="button-column" id="yw0_c4"> <input type="text" class="search" placeholder="Search" /></th>
						</tr>
					</thead>
					<tbody class="list">
						<tr class="odd">
							<td class="id">959</td>
							<td class="name">test</td>
							<td class="url">http://actionpay.ru/ru/</td>
							<td class="date_edit" style="width: 180px;">08.12.2014, 17:26:18</td>
							<td style="width: 95px">
								<a style="margin-left: 5px;" class="edit" rel="tooltip" href="/edit/959" data-original-title="Редактировать"><i class="icon-edit"></i></a>
								<a style="margin-left: 5px;" rel="tooltip" href="/generate/959" data-original-title="Генерировать"><i class="icon-file"></i></a>
								<a style="margin-left: 5px;" onclick="showRunDialog(this);" rel="tooltip" href="#" data-original-title="Управление запуском"><i class="icon-play"></i></a>
								<a style="margin-left: 5px;" onclick="showResultDialog(this);" rel="tooltip" href="#" data-original-title="Результат выполнения"><i class="icon-folder-open"></i></a>
								<a style="margin-left: 5px;" class="delete" rel="tooltip" href="/main/delete/959" data-original-title="Удалить"><i class="icon-remove"></i></a>
							</td>
						</tr>
						<tr class="even">
							<td class="id">955</td>
							<td class="name">cpainfo</td>
							<td class="url">http://cpainform.ru/programs/funservices/santa4me/</td>
							<td class="date_edit" style="width: 180px;">12.12.2014, 18:56:27</td>
							<td style="width: 95px">
								<a style="margin-left: 5px;" class="edit" rel="tooltip" href="/edit/955" data-original-title="Редактировать"><i class="icon-edit"></i></a>
								<a style="margin-left: 5px;" rel="tooltip" href="/generate/955" data-original-title="Генерировать"><i class="icon-file"></i></a>
								<a style="margin-left: 5px;" onclick="showRunDialog(this);" rel="tooltip" href="#" data-original-title="Управление запуском"><i class="icon-play"></i></a>
								<a style="margin-left: 5px;" onclick="showResultDialog(this);" rel="tooltip" href="#" data-original-title="Результат выполнения"><i class="icon-folder-open"></i></a>
								<a style="margin-left: 5px;" class="delete" rel="tooltip" href="/main/delete/955" data-original-title="Удалить"><i class="icon-remove"></i></a>
							</td>
						</tr>
					</tbody>
					</table>
					<div class="keys" style="display:none" title="/main"><span>959</span><span>955</span></div>
				</div>

<!-- RUN SETTING-->
				<div class="popup runcontrol ui-draggable" id="runcontrol" style="display: none; left: 339px; top: 151px;">
					<div class="popup-title">
						<div class="popup-close"><button class="close">×</button></div>
						<h3>Управление запуском (beta)</h3>
					</div>
					<div class="popup-body">
							<div style="width: 80%; float: left; margin-right: 10px">
						<fieldset>
							<input type="hidden" name="scrid" value="955">
							<input type="radio" name="runtype" value="single" checked="checked">&nbsp;Одиночный запуск			<br><br>
							<input type="radio" name="runtype" value="shedule">&nbsp;Запуск по расписанию			<table id="shedulesetup" style="margin-left: 40px;">
								<tbody><tr>
									<td style="width: 120px;"><span class="left-td">Начать в</span></td>
									<td>Дата:<input type="text" name="sheduledate" class="datepicker" style="width: 80px;"/>&nbsp;&nbsp;&nbsp;Время:<input type="text" name="sheduletime" style="width: 50px;"/>
										<br><span class="hint">Например: 2013-12-03  14:15</span>
									</td>
								</tr>
								<tr>
									<td style="width: 120px;"><span class="left-td">Повторять</span></td>
									<td><select name="repeat">
											<option value="hour">каждый час</option>
											<option value="3hour">каждые 4 часа</option>
											<option value="8hour">каждые 8 часов</option>
											<option value="12hour">каждые 12 часов</option>
											<option value="day">каждые 24 часа</option>
											<option value="3day">каждые 3 дня</option>
											<option value="week">каждые 7 дней</option>
											<option value="2week">каждые 2 недели</option>
											<option value="month">каждый месяц</option>
										</select>
									</td>
								</tr>
							</tbody></table>
						</fieldset>
						<fieldset>
							<legend>Статус</legend>
							<span class="runstatus" id="notrun" style="display: inline;">не выполняется</span>
							<span class="runstatus" id="run" style="display: none;">выполняется</span>
							<span class="runstatus" id="wait" style="display: none;">ожидает запуска</span>
							<span class="runstatus" id="waitshed" style="display: none;">ожидает запуска по расписанию</span>
							<span class="runstatus" id="limit" style="display: none;">превышен лимит</span>
							<span class="myprogressbar" style="float: right; width: 200px;"><span style="width: 0%;">&nbsp;</span></span>
						</fieldset>
					</div>
					<div>
						<button id="btnrun" class="btn btn-large"><i class="icon-play"></i>&nbsp;Запуск</button>
						<button id="btnstop" class="btn btn-large" style="display: none;"><i class="icon-stop"></i>&nbsp;Стоп</button>
					</div>
					</div>
				</div>
<!-- RUN SETTING-->

<!-- RUN RESULT-->
				<div class="popup runcontrol ui-draggable" id="runresult" style="display: none; left: 239px; top: 51px;">
					<div class="popup-title">
						<div class="popup-close"><button class="close">×</button></div>
						<h3>Результат выполнения</h3>
					</div>
					<div class="popup-body">
							<fieldset style="overflow: hidden;">
						<span class="line">
							Парсер:&nbsp;<span id="scrname">cpainfo</span>
							<span style="width: 100px; display: inline-block;">&nbsp;</span>
							Стартовая страница:&nbsp;<span id="startpage">http://cpainform.ru/programs/funservices/santa4me/</span>
						</span>
						<br>
						Последний запуск:&nbsp;<span id="lastrun">01.01.1970, 4:00:00</span>
					</fieldset>
					<fieldset>
						<legend>Вывод</legend>
						<div id="runoutput" style="overflow: auto; height: 150px; font-size: 12px;"></div>
					</fieldset>
					<fieldset>
						<legend>Файлы</legend>
						<div style="overflow: auto; height: 150px; padding: 0; margin: 0">
							<table id="files" class="table table-striped table-condensed" style="width: 50%; float: left">
								<!-- <thead>
									<tr>
										<td style="width: 300px">Имя файла</td>
										<td></td>
									</tr>
								</thead> -->
								<tbody></tbody>
							</table>
							&nbsp;&nbsp;&nbsp;
							<button id="zip" class="btn btn-small" href="http://scraperlab.com/execserver/api/download?file=3ac3723b9248900b6c6f15ad86c1c9c1&amp;zip=1" onclick="SaveZip(this);">Сохранить все</button>			
							<button id="delall" class="btn btn-small" href="http://scraperlab.com/execserver/api/download?file=3ac3723b9248900b6c6f15ad86c1c9c1&amp;deleteall=1" onclick="DeleteAll(this);">Удалить все</button>
						</div>
					</fieldset>
					</div>
				</div>
<!-- RUN RESULT-->


<!-- DEL-->				
				<div id="deleteModal" class="modal fade" style="display: none;">
				<div class="modal-header">
					<a class="close" data-dismiss="modal">×</a>
					<h3>Удаление парсера</h3>
				</div>
				 <div class="modal-body">
					<p>Вы действительно хотите удалить парсер?</p>
				</div>
				 <div class="modal-footer">
					<a data-dismiss="modal" id="ok-del-btn" class="btn remove-item-btn" href="/main/delete/955">OK</a>    <a data-dismiss="modal" id="cancel-del-btn" class="btn" href="#">Отмена</a></div>
				</div>
<!-- DEL-->	


<!-- CREATE-->	
				<div id="createModal" class="modal fade" style="display: none;" >
					<div class="modal-header">
						<a class="close" data-dismiss="modal">×</a>
						<h3>Создать парсер</h3>
					</div>
					<div class="modal-body">
						<form class="form1 form-vertical" id="form" action="/main/create" method="post"> 
						<fieldset>
							<label for="CreateScraperForm_name" class="required">Название <span class="required">*</span></label>
							<input name="CreateScraperForm[name]" id="name-field" type="text">	
							<label for="CreateScraperForm_startpage" class="required">Стартовая страница <span class="required">*</span></label>
							<input style="width: 400px;" name="CreateScraperForm[startpage]" id="url-field" type="text">
						</fieldset>
						<br>
						</form>
					</div>
					<div class="modal-footer">
						<a data-dismiss="modal" id="add-btn" class="btn" href="/create/" >OK</a>    <a data-dismiss="modal" id="cancel-del-btn" class="btn" href="#">Отмена</a>
					</div>
				</div>
<!-- CREATE-->


<!-- EDIT-->					
				<div id="editModal" class="modal fade"  style="display: none; margin: 0px; top: 0px;left:0px; width:100%;">
					<div class="modal-header">
						<a class="close" data-dismiss="modal">×</a>
						<h3 id = "js_name">Edit</h3>
					</div>
					<div class="modal-body" style="max-height:80%;">
									
<div class="tabbable tabs-right">				
		<ul id="sidetabs" class="nav nav-tabs">
			<li class="active"><a id="tab-browser" data-toggle="tab" href="#tabBrowser">Браузер</a></li>
			<li ><a id="tab-script"  data-toggle="tab" href="#tabScript" onclick="tabScriptClick();">Скрипт</a></li>			
			<li><a id="tab-export" data-toggle="tab" href="#tabExport">Экспорт</a></li>
			
			<div id="rules-right-btns">
				<div class="success">
					<img style="display: none;" src="images/ajax-loader2.gif" />
					<div></div>
				</div>
				<button class="btn" onclick="rulessave();">Сохранить</button><br/>
				<button id="btnclose" class="btn" onclick="rulesclose();" href="/main">Закрыть</button>
				<br/><br/><br/>
				<a href="/generate/955" style="display: inline-block; width: 90px; text-align:center; text-decoration: underline;">
					Генерировать				</a>
					<br>
				<a href="#" onclick="htmltree(this);">GET XPath</a>	
			</div>
		</ul>
		
		<div class="tab-content">
			<div id="tabBrowser" class="tab-pane active">
			
				<div  class="btn-group" data-toggle="buttons">
						<input type="radio" name="type" value="1" checked="checked">HTML
						<input type="radio" name="type" value="2">XML
						<input type="checkbox" name="base" id="js_base_btn">BaseTag
				</div>
				
				
				<div id="panel">
					<!--<div style="float: right; margin-top: 1px;">
						<button onclick="togglebrowser();" class="btn" title="Свернуть/Развернуть браузер">
							<i class="icon-resize-vertical"></i>
						</button>
					</div> -->
					<div class="form-inline" style="float:left; margin-right:30px;">
                        <button onclick="loadprev();" class="btn" title="Назад">
							<i class="icon-arrow-left"></i>
						</button>
						<button onclick="loadnext();" class="btn" title="Вперёд">
							<i class="icon-arrow-right"></i>
						</button>
						<input type="text" name="url" id="js_url" value="" placeholder="Введите url страницы" style="width: 300px;"/>
						<button onclick="loadpage_nourl(false, true);" class="btn" title="Обновить страницу в кэше"><i class="icon-repeat"></i></button>
						<button onclick="loadtree();" class="btn" title="Загружаемые страницы">
							<i class="icon-th-list"></i>
						</button>
					</div>
					<div class="btn-toolbar">
						<div class="btn-group" data-toggle="buttons-radio">
							<button id="seltext" class="btn btn-width"><i class="icon-align-left"></i>&nbsp;Текст</button>						
							<button id="selimg" class="btn btn-width"><i class="icon-picture"></i>&nbsp;Картинка</button>
							<button id="sellink" class="btn btn-width"><i class="icon-font"></i>&nbsp;Ссылка</button>
							<button id="golink" class="btn"><i class="icon-share-alt"></i>&nbsp;Загрузить ссылку</button>
							<button id="selhtml" class="btn btn-width"><i class="icon-chevron-left"></i><i class="icon-chevron-right"></i>&nbsp;HTML</button>
						</div>
						<div class="btn-group">
							<button id="selre" class="btn" onclick="getregexp();">RegExp</button>
						</div>
					</div>
				</div>
				
				<textarea id="js_tpl" style="margin: 0px 0px 9px; width: 1079px; height: 82px;"></textarea>
				<div id="iframes">
					<div id="hovered-element" ><div id="hovered-element-info"></div></div>					
					<iframe id="html" name="html" width="99%" height="350" ></iframe>
					<iframe id="html2" width="99%" style="display: none;"></iframe>
				</div>
				
				<div class="btn-toolbar">
					<div class="btn-group">
						<button id="rulegroup" onclick="rulegroup();" class="btn">Объединить</button>
					</div>
					<div class="btn-group">
						<button id="ruledelete" onclick="ruledel();" class="btn">Удалить</button>
					</div>
										<select name="groupfilter" title="Фильтр группы" style="width: 100px; display: inline-block; vertical-align: top; margin-left: 20px; margin-right: 20px;">
						<option value="all">Все</option>
					</select>
					<div class="btn-group">
						<button id="ruleexport" onclick="pageexport();" class="btn">Правило экспорта</button>
					</div>
					<div class="btn-group">
						<button id="viewdata" onclick="pagedata();" class="btn">Собранные данные</button>
					</div>
				</div>
				<div id="rules-container">
					<!-- <button id="js_add_rule" class="btn btn-default">Add Item</button> -->
					<div id="" class="js_items" ></div>
<!--
				<table id="rulestbl" class="table table-striped table-bordered">
					<thead>
						<tr>
							<th style="width: 15px;"></th>
							<th style="width: 100px;">Имя</th>
							<th style="width: 80px;">Тип</th>
							<th style="width: 80px;">Группа</th>
							<th>XPath</th>
							<th style="width: 80px;"></th>
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
-->
				</div>
				
				<div class="popup2" id="itemname">
					<div id="labels">Выделено:&nbsp;
						<span class="label" id="text">Текст</span>
						<span class="label" id="link">Ссылка</span>
						<span class="label" id="image">Картинка</span>
						<span class="label" id="regexp">RegExp</span>
						<span class="label" id="htmltype">HTML</span>
					</div>
					<div style="float:left">
						<div>Введите имя:</div>
						<div class="form-inline">
							<input type="text" class = "js_name" name="name" />
						</div>
					</div>
					<div style="float:left">
						<div>Тип:</div>
						<div class="form-inline">
							<select class="form-control type js_type selattr" name="type" style="width: 100px;">
								<option value=""></option>
								<option value="link">Ссылка</option>
								<option value="text">Текст</option>
								<option value="html">HTML</option>
								<option value="img">Картинка</option>
								<option value="table">table</option>
							</select>
						</div>
					</div>
					<div style="float:left">
						<div>Parent:</div>
						<div class="form-inline">
							<select class="form-control parent js_parent selattr" name="parent"  style="width: 100px;">
								<option value=""></option>
							</select>
						</div>
					</div>
					<div style="float:left; ">
						<button class="btn" onclick="setItem();" style="margin-top: 18px;">OK</button>
					</div>
				</div>
				
				<div class="popup" id="ruleedit">
					<div class="popup-title">
						<div class="popup-close"><button class="close">&times;</button></div>
						<h3></h3>
					</div>
					<div class="popup-body">
						<div id="labels">
							<span id="rulename"></span>&nbsp;&nbsp;&nbsp;&nbsp;
							<span class="label" id="text">Текст</span>
							<span class="label" id="link">Ссылка</span>
							<span class="label" id="image">Картинка</span>
							<span class="label" id="regexp">RegExp</span>
							<span class="label" id="htmltype">HTML</span>
						</div>
						<textarea name="xpath" spellcheck="false"></textarea>
						<input type="hidden" name="name" />
						<div>
							<button class="btn" onclick="cancelRuleXPath();" style="float:right; margin-left:10px;">Отмена</button>
							<button class="btn" onclick="setRuleXPath();" style="float:right;">OK</button>
						</div>
					</div>
				</div>
				<div class="popup" id="pageexport">
	<div class="popup-title">
		<div class="popup-close"><button class="close">&times;</button></div>
	 	<h3>Правило экспорта для страницы</h3>
	</div>
	<div class="popup-body">
						<div id="pageexport-list">
					<div>
						<div style="float: right;"><button onclick="pageExportListNew();" class="btn"><i class="icon-plus"></i>&nbsp;Добавить</button></div>
					</div>
					<div style="clear: both;"></div>
					<div id="pageexport-list-table">
						<table class="table">
							<thead>
								<tr>
									<td style="width: 40px;">#</td>
									<td style="width: 100px;">Профиль</td>
									<td style="width: 50px;">Тип</td>
									<td>Команда</td>
									<td style="width: 90px;"></td>
								</tr>
							</thead>
							<tbody></tbody>
						</table>
					</div>
					<div class="popup-btns">
												<button class="btn" onclick="setPageExportList();" style="float:right;">OK</button>
					</div>
				</div>
				<div id="pageexport-profile">
					<div style="float: left;">
						<input type="hidden" name="pageexport-profile-ind" />
						<label>Выберите профиль:</label>
						<select name="exportname" style="width: 200px;">
						</select>&nbsp;&nbsp;&nbsp;&nbsp;
						<span class="label" id="labelcsv">csv</span>
						<span class="label" id="labelxml">xml</span>
						<span class="label" id="labelsql">sql</span>
						<span class="label" id="labelexcel">Excel</span>
						<span class="label" id="labelrdb">rdb</span>
					</div>
					<div id="divfilename" style="float: left; margin-left: 50px;">
						<label>Имя создаваемого файла:</label>
						<input type="text" name="filename" style="width: 150px;"/>
					</div>
					<div id="divretvarname" style="float: left; margin-left: 50px;">
						<label>Результат в переменную:</label>
						<input type="text" name="retvarname" style="width: 150px;"/>
					</div>
					<div style="clear: both;"></div>
					<div id="savearray">
						<div>
							<button onclick="pageExportItemAdd();" class="btn btn-mini" style="float: right; margin-right: 5px;"><i class="icon-plus"></i>&nbsp;Добавить</button>
							<label style="float: left;">Параметры (array):</label>
						</div>
						<div style="clear: both;"></div>
						<div id="savearray-table">
							<table class="table">
							</table>
						</div>
					</div>
					<div id="savedict">
						<div>
							<label style="float: left;">Параметры (dict):</label>
						</div>
						<div style="clear: both;"></div>
						<div id="savedict-table">
							<table class="table">
							</table>
						</div>
					</div>
					<br/>
					<div class="popup-btns">
						<button class="btn" onclick="cancelPageExport();" style="float:right; margin-left:10px;">Отмена</button>
						<button class="btn" onclick="setPageExport();" style="float:right;">OK</button>
					</div>
				</div>
					</div>
</div>
				<div class="popup" id="ruleoptions">
	<div class="popup-title">
		<div class="popup-close"><button class="close">&times;</button></div>
	 	<h3>Параметры правила</h3>
	</div>
	<div class="popup-body">
							<input type="hidden" name="rulename" value="" />
					<div id="linkopt">
												<label class="checkbox">
							<input type="checkbox" name="optstorefile" />
							Сохранять файл по ссылке						</label>
						<div class="optline">
							<label class="checkbox" style="float:left; margin-right: 20px;">
								<input type="checkbox" name="optnext" />
								Следующий элемент							</label>
							<select name="optnexttype" style="width:150px;">
								<option value="link">Ссылка</option>
								<option value="text">Текст</option>
								<option value="image">Картинка</option>
							</select>
						</div>
						<label class="checkbox">
							<input type="checkbox" name="optcontinue" />
							Добавить в очередь загрузки						</label>
					</div>
					<div id="textopt">
																		<label class="checkbox">
							<input type="checkbox" name="optnodeonly" />
							Только text node						</label>
						<div style="margin-bottom: 5px;">
							<label class="checkbox" style="float:left; margin-right: 20px;">
								<input type="checkbox" name="optnext" />
								Следующий элемент							</label>
							<select name="optnexttype" style="width:150px;">
								<option value="link">Ссылка</option>
								<option value="text">Текст</option>
								<option value="image">Картинка</option>
								<option value="html">HTML</option>
							</select>
						</div>
						<div style="margin-bottom: 5px;">
							<label class="checkbox" style="float:left; margin-right: 20px;">
								<input type="checkbox" name="optword" />
								Выделить слово							</label>
							<input type="text" name="optwordnumber" style="width:50px;" />
							-
							<input type="text" name="optwordnumber2" style="width:50px;" />
						</div>
						<div style="margin-bottom: 5px;">
							<label class="checkbox" style="float:left; margin-right: 20px;">
								<input type="checkbox" name="optimplode" />
								Соединить строки в одну							</label>
							<input type="text" name="optimplodestr" style="width:80px;" title="Разделитель"/>
						</div>
						<div style="margin-bottom: 5px;">
							<label class="checkbox" style="float:left; margin-right: 20px;">
								<input type="checkbox" name="optreplace" />
								Заменить символы							</label>
							<input type="text" name="optreplacesearch" style="width:80px;" title="Искать (regex)"/>
							на							<input type="text" name="optreplacereplace" style="width:80px;" title="Замена"/>
						</div>
					</div>
					<div id="imageopt">
												<label class="checkbox">
							<input type="checkbox" name="optstorefile" />
							Сохранять файл изображения						</label>
						<div style="margin-bottom: 5px;">
							<label class="checkbox" style="float:left; margin-right: 20px;">
								<input type="checkbox" name="optnext" />
								Следующий элемент							</label>
							<select name="optnexttype" style="width:150px;">
								<option value="link">Ссылка</option>
								<option value="text">Текст</option>
								<option value="image">Картинка</option>
								<option value="html">HTML</option>
							</select>
						</div>
					</div>
					<div id="formopt">
					</div>
					<div id="htmlopt">
												<div style="margin-bottom: 5px;">
							<label class="checkbox" style="float:left; margin-right: 20px;">
								<input type="checkbox" name="optnext" />
								Следующий элемент							</label>
							<select name="optnexttype" style="width:150px;">
								<option value="link">Ссылка</option>
								<option value="text">Текст</option>
								<option value="image">Картинка</option>
								<option value="html">HTML</option>
							</select>
						</div>
						<label class="checkbox">
							<input type="checkbox" name="optcontent" />
							Возвращать только содержимое (innerHTML)						</label>
					</div>
					<div class="popup-btns">
						<button class="btn" onclick="cancelRuleOptions();" style="float:right; margin-left:10px;">Отмена</button>
						<button class="btn" onclick="setRuleOptions();" style="float:right;">OK</button>
					</div>
					</div>
</div>				
				<div class="popup" id="rulesetgroup">
	<div class="popup-title">
		<div class="popup-close"><button class="close">&times;</button></div>
	 	<h3>Установка группы</h3>
	</div>
	<div class="popup-body">
						
					<div id="labels" style="margin-bottom: 10px;">
						<span id="rulename"></span>&nbsp;&nbsp;&nbsp;&nbsp;
						
<span class="label" id="text">Текст</span>
<span class="label" id="link">Ссылка</span>
<span class="label" id="image">Картинка</span>
<span class="label" id="regexp">RegExp</span>
<span class="label" id="htmltype">HTML</span>
					</div>
					<label>
						Выберите группу:						<select name="groups"></select>
					</label>
					<label>
						Добавить в новую группу:<br/>
						<input type="input" name="setname" />
					</label>
					<input type="hidden" name="name" />
					<div class="popup-btns">
						<button class="btn" onclick="cancelRuleSetGroup();" style="float:right; margin-left:10px;">Отмена</button>
						<button class="btn" onclick="setRuleSetGroup();" style="float:right;">OK</button>
					</div>
					</div>
</div>				
				<div class="popup" id="pagedata">
	<div class="popup-title">
		<div class="popup-close"><button class="close">&times;</button></div>
	 	<h3>Собранные данные</h3>
	</div>
	<div class="popup-body">
							<div id="pagedata-data">
					</div>
					<div class="popup-btns">
												<button class="btn" onclick="setPageData();" style="float:right;">OK</button>
					</div>
					</div>
</div>
				<div class="popup" id="rulefilter">
	<div class="popup-title">
		<div class="popup-close"><button class="close">&times;</button></div>
	 	<h3>Фильтрация данных правила</h3>
	</div>
	<div class="popup-body">
							<div id="labels" style="margin-bottom: 10px;">
						<span id="rulename"></span>&nbsp;&nbsp;&nbsp;&nbsp;
						
<span class="label" id="text">Текст</span>
<span class="label" id="link">Ссылка</span>
<span class="label" id="image">Картинка</span>
<span class="label" id="regexp">RegExp</span>
<span class="label" id="htmltype">HTML</span>

					</div>
					<label style="float: left; margin-right: 40px;">
						Тип:						<select name="filtertype" style="width: 150px;">
							<option value="equal">equal</option>
							<option value="notequal">notequal</option>
							<option value="regexp">regexp</option>
							<option value="notregexp">notregexp</option>
							<option value="condition">condition</option>
						</select>
					</label>
					<label>
						Значение:<br/>
						<input type="text" name="filterstr" class="span4" style="float: left; margin-right: 20px;"/>
						<button class="btn" onclick="setRuleFilter();">Применить</button>
					</label>
					<input type="hidden" name="name" />
					</div>
</div>				
				<div class="popup" id="getregexp">
	<div class="popup-title">
		<div class="popup-close"><button class="close">&times;</button></div>
	 	<h3>Правило RegExp</h3>
	</div>
	<div class="popup-body">
							<div style="margin-bottom: 10px;">
						<span>Имя правила:</span>
						<input type="text" name="rulename" style="margin-right: 30px; width: 100px;"/>
						<span>Шаблон RegExp:</span>
						<input type="text" name="pattern" style="width: 300px; margin-right: 30px;"/>
						<span>Возвращать result[</span>
						<input type="text" name="resultind" style="width: 50px;" value="0"/>
						<span>]</span>
						<br/>
					</div>
					<div style="float:left; width: 70%; margin-right: 10px;">
						<pre id="source" style="overflow: auto; height: 350px;"></pre>
						<!-- <textarea id="source" class="ldt-input2" spellcheck="false"></textarea>  -->
					</div>
					<div>
						<!-- <textarea name="reout" class="nonshadow" spellcheck="false" wrapp="off"></textarea> -->
						<pre id="reout" style="overflow: auto; word-break: normal; word-wrap: normal; white-space: pre; height: 350px;"></pre>
					</div>
					<div class="popup-btns">
						<button class="btn" onclick="cancelGetRegExp();" style="float:right; margin-left:10px;">Отмена</button>
						<button class="btn" onclick="setGetRegExp();" style="float:right;">OK</button>
					</div>
					</div>
</div>
				<div class="popup" id="loadtree">
	<div class="popup-title">
		<div class="popup-close"><button class="close">&times;</button></div>
	 	<h3>Загружаемые страницы</h3>
	</div>
	<div class="popup-body">
							<div id="loadtree-content">
						<ul>
							<li><img class="plus" src="images/icon-opened.gif"/><span>page1</span><br/>
								<ul>
									<li><img class="plus" src="images/icon-opened.gif"/><span class="selected">page1_1</span></li>
									<li><img class="plus" src="images/icon-opened.gif"/><span>page1_2</span></li>
								</ul>
							</li>
							<li><img class="plus" src="images/icon-opened.gif"/><span>page2</span></li>
						</ul>
					</div>
					<div class="popup-btns">
						<button class="btn" onclick="cancelLoadTree();" style="float:right; margin-left:10px;">Отмена</button>
						<button class="btn" onclick="setLoadTree();" style="float:right;">OK</button>
					</div>
					</div>
</div>
				<div class="popup" id="htmltree">
	<div class="popup-title">
		<div class="popup-close"><button class="close">&times;</button></div>
	 	<h3>Дерево html элементов</h3>
	</div>
	<div class="popup-body">
							<div id="htmltree-content">
					</div>
					<!-- <span>XPath</span><input type="text" name="xpath" style="width: 90%; margin-left: 10px;"/>  -->
					<textarea name="xpath" spellcheck="false" style="width: 97%"></textarea>
					<input type="hidden" name="name" />
					<div class="popup-btns">
						<button class="btn" onclick="cancelHtmlTree();" style="float:right; margin-left:10px;">Отмена</button>
						<button class="btn" onclick="setHtmlTree();" style="float:right;">OK</button>
						<div id="labels">
							<span id="rulename"></span>&nbsp;&nbsp;&nbsp;&nbsp;
							
<span class="label" id="text">Текст</span>
<span class="label" id="link">Ссылка</span>
<span class="label" id="image">Картинка</span>
<span class="label" id="regexp">RegExp</span>
<span class="label" id="htmltype">HTML</span>
							
						</div>
					</div>
					</div>
</div>								
			</div>
			
			<div id="tabScript" class="tab-pane ">
				<div id="script-container">
				<div class="btn-toolbar">
					<!-- <div style="float: right; margin-top: 1px; border: 1px solid">
						Строка: 0 Колонка: 0
					</div>-->
										<div class="btn-group">
						<button class="btn" onclick="parseexec();">Выполнить</button>
					</div>
					<div class="btn-group">
						<button class="btn">Строка:</button>
						<button class="btn" id="lineid">0</button>
					</div>
					<div class="btn-group">
						<button class="btn">Колонка:</button>
						<button class="btn" id="columnid">0</button>
					</div>
					&nbsp;&nbsp;<input type="checkbox" name="disablebrowser"  style="vertical-align: top; margin-top: 10px;" />
					<div class="btn-group">
						<button class="btn" onclick="disableBrowser(this);">
							Отключить от браузера						</button>
					</div>
					<div class="btn-group">
						<button class="btn" onclick="showHelper();">Помощник</button>
					</div>
				</div>
				
				<textarea id="script" class="ldt-input" wrap="off" spellcheck="false">loadpage('http://cpainform.ru/programs/funservices/santa4me/') {
    group 'group1' {
        title = gettext('//html/body/div[@id="globalContainer"]/div[@id="globalContainer"]/table[1]/tbody[1]/tr[1]/td[@id="mainContent"]/h1[1]');
    }
}
</textarea>
				<br/><label>Вывод:</label>
				<textarea id="output" wrap="off" spellcheck="false" readonly="readonly"></textarea>
				
				</div>
				<input type="hidden" name="scraperid" value="955"/>
								
				<div class="popup2" id="helper">
					<div class="tabbable tabs-left">
						<ul class="nav nav-pills nav-stacked" style="float:left; margin-right: 15px; height: 470px; overflow-y: scroll">
							<li class="active"><a href="#func1" data-toggle="tab">loadpage</a></li>
							<li><a href="#func29" data-toggle="tab">group</a></li>
							<li><a href="#func2" data-toggle="tab">gettext</a></li>
							<li><a href="#func3" data-toggle="tab">getlink</a></li>
							<li><a href="#func4" data-toggle="tab">getimglink</a></li>
							<li><a href="#func5" data-toggle="tab">getregexp</a></li>
							<li><a href="#func6" data-toggle="tab">getattr</a></li>
							<li><a href="#func36" data-toggle="tab">gethtml</a></li>
							<li><a href="#func7" data-toggle="tab">store</a></li>
							<li><a href="#func8" data-toggle="tab">storefile</a></li>
							<li><a href="#func9" data-toggle="tab">continue</a></li>
							<li><a href="#func10" data-toggle="tab">dump</a></li>
							<li><a href="#func11" data-toggle="tab">generateurl</a></li>
							<li><a href="#func12" data-toggle="tab">concat</a></li>
							<li><a href="#func13" data-toggle="tab">regexp</a></li>
							<li><a href="#func14" data-toggle="tab">filter_key</a></li>
							<li><a href="#func15" data-toggle="tab">filter_value</a></li>
							<li><a href="#func28" data-toggle="tab">filter_eqkeys</a></li>
							<li><a href="#func16" data-toggle="tab">foreach</a></li>
							<li><a href="#func17" data-toggle="tab">if else</a></li>
							<li><a href="#func18" data-toggle="tab">count</a></li>
							<li><a href="#func20" data-toggle="tab">maketable</a></li>
							<li><a href="#func19" data-toggle="tab">store_table</a></li>
							<li><a href="#func21" data-toggle="tab">dbconnect</a></li>
							<li><a href="#func22" data-toggle="tab">dbfind</a></li>
							<li><a href="#func23" data-toggle="tab">dbinsert</a></li>
							<li><a href="#func24" data-toggle="tab">dbupdate</a></li>
							<li><a href="#func25" data-toggle="tab">dbdelete</a></li>
							<li><a href="#func26" data-toggle="tab">dbclose</a></li>
							<li><a href="#func27" data-toggle="tab">mail</a></li>
							<li><a href="#func30" data-toggle="tab">getform</a></li>
							<li><a href="#func31" data-toggle="tab">submitform</a></li>
							<li><a href="#func32" data-toggle="tab">formgetparam</a></li>
							<li><a href="#func33" data-toggle="tab">formsetparam</a></li>
							<li><a href="#func34" data-toggle="tab">formgetselectkey</a></li>
							<li><a href="#func35" data-toggle="tab">formgetselectvalue</a></li>
							<li><a href="#func37" data-toggle="tab">removetags</a></li>
							<li><a href="#func38" data-toggle="tab">basename</a></li>
	    				</ul>
	    				<div class="tab-content">
	    					<div style="float: right"><button class="close">&times;</button></div>
	    					<div class="tab-pane active" id="func1">
								<p><strong>loadpage</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.loadpage"><i class="icon-question-sign"></i></a></p>
								<p>Загружает страницу по заданному url.</p>
								<label>Url<span class="required">*</span></label>
								<input type="text" name="url" class="span12"/>
								<label>Метод</label>
								<select name="method" class="span12">
									<option value="get" selected="selected">get</option>
									<option value="post">post</option>
								</select>
								<label>Параметры (dict)</label>
								<input type="text" name="params" class="span12" value="" />
								<label>Оригинальная кодировка</label>
								<input type="text" name="encoding" class="span12" value="" />
								<label>Заголовки (array)</label>
								<input type="text" name="headers" class="span12" value="" />
								 
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func2">
								<p><strong>gettext</strong>
									&nbsp;<a target="_blank"  href="/ru/docs/funcs.gettext"><i class="icon-question-sign"></i></a>
								</p>
								<p>Получает текстовое содержимое по заданному xpath. Допустимо только внутри loadpage.</p>
								<label>XPath<span class="required">*</span></label>
								<input type="text" name="xpath" class="span12"/>
								<label>Опции</label>
								<input type="checkbox" name="textnode" />&nbsp;Только text node<br/>
								<input type="checkbox" name="next" />&nbsp;Следующий элемент<br/>
								<input type="checkbox" name="word" />&nbsp;Выделить слово<br/>
								<input type="text" name="wordnumber" class="span4" value="1" style="display: inline"/>
								 -  
								<input type="text" name="wordnumber2" class="span4" value="1" style="display: inline"/>
																<br/><br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func3">
								<p><strong>getlink</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.getlink"><i class="icon-question-sign"></i></a>
								</p>
								<p>Получает ссылку по заданному xpath. Допустимо только внутри loadpage.</p>
								<label>XPath<span class="required">*</span></label>
								<input type="text" name="xpath" class="span12"/>
								<label>Опции</label>
								<input type="checkbox" name="next" />&nbsp;Следующий элемент<br/>
																<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func4">
								<p><strong>getimglink</strong>
									&nbsp;<a target="_blank"  href="/ru/docs/funcs.getimglink"><i class="icon-question-sign"></i></a>
								</p>
								<p>Получает ссылку на картинку по заданному xpath. Допустимо только внутри loadpage.</p>
								<label>XPath<span class="required">*</span></label>
								<input type="text" name="xpath" class="span12"/>
								<label>Опции</label>
								<input type="checkbox" name="next" />&nbsp;Следующий элемент<br/>
																<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func5">
								<p><strong>getregexp</strong>
									&nbsp;<a target="_blank"  href="/ru/docs/funcs.getregexp"><i class="icon-question-sign"></i></a>
								</p>
								<p>Получает текст со страницы в соответстии с регулярным выражением. Допустимо только внутри loadpage.</p>
								<label>Шаблон<span class="required">*</span></label>
								<input type="text" name="pattern" class="span12"/>
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func6">
								<p><strong>getattr</strong>
									&nbsp;<a target="_blank"  href="/ru/docs/funcs.getattr"><i class="icon-question-sign"></i></a>
								</p>
								<p>Получает атрибут html элемента, заданного xpath выражением. Допустимо только внутри loadpage.</p>
								<label>XPath<span class="required">*</span></label>
								<input type="text" name="xpath" class="span12"/>
								<label>Название атрибута<span class="required">*</span></label>
								<input type="text" name="attr" class="span12"/>
								<label>Опции</label>
								<input type="checkbox" name="next" />&nbsp;Следующий элемент<br/>
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func7">
								<p><strong>store</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.store"><i class="icon-question-sign"></i></a>
								</p>
								<p>Сохраняет данные в соответствии с заданным профилем экспорта. Допустимо только внутри loadpage.</p>
								<label>Профиль экспорта<span class="required">*</span></label>
								<input type="text" name="profile" class="span12" value="&apos;csv&apos;"/>
								<label>Имя сохраняемого файла<span class="required">*</span></label>
								<input type="text" name="filename" class="span12" value="&apos;data&apos;"/>
								<label>Сохраняемые данные (dict | array)<span class="required">*</span></label>
								<input type="text" name="data" class="span12"/>
																<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func8">
								<p><strong>storefile</strong>
									&nbsp;<a target="_blank"  href="/ru/docs/funcs.storefile"><i class="icon-question-sign"></i></a>
								</p>
								<p>Загружает и сохраняет файл по ссылке.</p>
								<label>Ссылка<span class="required">*</span></label>
								<input type="text" name="link" class="span12" />
																<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func9">
								<p><strong>continue</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.continue"><i class="icon-question-sign"></i></a>
								</p>
								<p>Добавляет ссылку в очередь загрузки для loadpage. Допустимо только внутри loadpage.</p>
								<label>Ссылка<span class="required">*</span></label>
								<input type="text" name="link" class="span12" />
																<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func10">
								<p><strong>dump</strong>
									&nbsp;<a target="_blank"  href="/ru/docs/funcs.dump"><i class="icon-question-sign"></i></a>
								</p>
								<p>Выводит значение переменной.</p>
								<label>Имя переменной<span class="required">*</span></label>
								<input type="text" name="varname" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func11">
								<p><strong>generateurl</strong>
									&nbsp;<a target="_blank"  href="/ru/docs/funcs.generateurl"><i class="icon-question-sign"></i></a>
								</p>
								<p>Генерирует массив ссылок в соответствии с шаблоном для загрузки с помощью loadpage.</p>
								<label>Шаблон ссылки<span class="required">*</span></label>
								<input type="text" name="pattern" class="span12" />
								<label>Параметры (dict)<span class="required">*</span></label>
								<input type="text" name="params" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func12">
								<p><strong>concat</strong>
									&nbsp;<a target="_blank"  href="/ru/docs/funcs.concat"><i class="icon-question-sign"></i></a>
								</p>
								<p>Соединяет две строки. В качестве параметров может принимать просто строки и массивы строк.</p>
								<label>Строка 1 (string | array)<span class="required">*</span></label>
								<input type="text" name="string1" class="span12" />
								<label>Строка 2 (string | array)<span class="required">*</span></label>
								<input type="text" name="string2" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func13">
								<p><strong>regexp</strong>
									&nbsp;<a target="_blank"  href="/ru/docs/funcs.regexp"><i class="icon-question-sign"></i></a>
								</p>
								<p>Выполняет поиск в строке всех подстрок, соответсвующих регулярному выражению.</p>
								<label>Шаблон регулярного выражения<span class="required">*</span></label>
								<input type="text" name="pattern" class="span12" />
								<label>Строка<span class="required">*</span></label>
								<input type="text" name="str" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func14">
								<p><strong>filter_key</strong>
									&nbsp;<a target="_blank"  href="/ru/docs/funcs.filterkey"><i class="icon-question-sign"></i></a>
								</p>
								<p>Фильтрует ключи массива или словаря в соответствии с регулярным выражением. Тип фильтрации может быть "соответсвует регулярному выражению" и "не соответсвует регулярному выражению".</p>
								<label>Данные (dict | array)<span class="required">*</span></label>
								<input type="text" name="data" class="span12" />
								<label>Тип фильтрации<span class="required">*</span></label>
								<select name="type" class="span12">
									<option value="regexp" selected="selected">regexp</option>
									<option value="notregexp">notregexp</option>
								</select>
								<label>Шаблон регулярного выражения<span class="required">*</span></label>
								<input type="text" name="str" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func15">
								<p><strong>filter_value</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.filtervalue"><i class="icon-question-sign"></i></a>
								</p>
								<p>Фильтрует значения массива или словаря в соответсвии с заданным значением. Тип фильтрации может быть "равен строке", "не равен строке", "соответсвует регулярному выражению" и "не соответсвует регулярному выражению".</p>
								<label>Данные (array | dict)<span class="required">*</span></label>
								<input type="text" name="data" class="span12" />
								<label>Тип фильтрации<span class="required">*</span></label>
								<select name="type" class="span12">
									<option value="equal" selected="selected">equal</option>
									<option value="notequal">notequal</option>
									<option value="regexp">regexp</option>
									<option value="notregexp">notregexp</option>
								</select>
								<label>Строка или регулярное выражение<span class="required">*</span></label>
								<input type="text" name="str" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func16">
								<p><strong>foreach</strong>
									&nbsp;<a target="_blank" href="/ru/docs/foreach"><i class="icon-question-sign"></i></a>
								</p>
								<p>Цикл. Перебирает все элементы массива или словаря и выполняет тело цикла.</p>
								<label>Массив или словарь (array | dict)<span class="required">*</span></label>
								<input type="text" name="data" class="span12" />
								<label>Переменная для ключа</label>
								<input type="text" name="key" class="span12" />
								<label>Переменная для значения<span class="required">*</span></label>
								<input type="text" name="val" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func17">
								<p><strong>if else</strong>
									&nbsp;<a target="_blank" href="/ru/docs/if"><i class="icon-question-sign"></i></a>
								</p>
								<p>Условие. Если значение логического условия не равно 0 выполняется тело if, иначе тело else.</p>
								<label>Логическое условие<span class="required">*</span></label>
								<input type="text" name="condition" class="span12" />
								<input type="checkbox" name="else" />&nbsp;else<br/>
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func18">
								<p><strong>count</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.count"><i class="icon-question-sign"></i></a>
								</p>
								<p>Возвращает количество элементов в массиве или словаре</p>
								<label>Массив или словарь<span class="required">*</span></label>
								<input type="text" name="data" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func19">
								<p><strong>store_table</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.storetable"><i class="icon-question-sign"></i></a>
								</p>
								<p>То же, что и store, только сохраняемые данные должны быть таблицей (см. maketable). Допустимо только внутри loadpage.</p>
								<label>Профиль экспорта<span class="required">*</span></label>
								<input type="text" name="profile" class="span12" value="&apos;csv&apos;"/>
								<label>Имя сохраняемого файла<span class="required">*</span></label>
								<input type="text" name="filename" class="span12" value="&apos;data&apos;"/>
								<label>Сохраняемые данные (array)<span class="required">*</span></label>
								<input type="text" name="data" class="span12"/>
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func20">
								<p><strong>maketable</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.maketable"><i class="icon-question-sign"></i></a>
								</p>
								<p>Создает таблицу (массив словарей или массив массивов) из массивов-столбцов.</p>
								<label>Массивы-столбцы (array | dict)<span class="required">*</span></label>
								<input type="text" name="data" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func21">
								<p><strong>dbconnect</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.dbconnect"><i class="icon-question-sign"></i></a>
								</p>
								<p>Устанавливает соединение с базой данных mysql. Возвращает идентификатор соединения.</p>
								<label>Хост<span class="required">*</span></label>
								<input type="text" name="host" class="span12" />
								<label>Пользователь<span class="required">*</span></label>
								<input type="text" name="user" class="span12" />
								<label>Пароль<span class="required">*</span></label>
								<input type="text" name="password" class="span12" />
								<label>Имя базы данных<span class="required">*</span></label>
								<input type="text" name="dbname" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func22">
								<p><strong>dbfind</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.dbconnect"><i class="icon-question-sign"></i></a>
								</p>
								<p>Ищет в базе данных записи с заданными атрибутами и/или по условию.</p>
								<label>Идентификатор соединения<span class="required">*</span></label>
								<input type="text" name="conn" class="span12" />
								<label>Таблица<span class="required">*</span></label>
								<input type="text" name="table" class="span12" />
								<label>Атрибуты (dict)<span class="required">*</span></label>
								<input type="text" name="attrs" class="span12" />
								<label>Условие</label>
								<input type="text" name="condition" class="span12" />
								<label>Параметры условия (dict)</label>
								<input type="text" name="params" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func23">
								<p><strong>dbinsert</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.dbinsert"><i class="icon-question-sign"></i></a>
								</p>
								<p>Вставляет в базу данных запись с заданными атрибутами. Возвращает id вставленной записи.</p>
								<label>Идентификатор соединения<span class="required">*</span></label>
								<input type="text" name="conn" class="span12" />
								<label>Таблица<span class="required">*</span></label>
								<input type="text" name="table" class="span12" />
								<label>Атрибуты (dict)<span class="required">*</span></label>
								<input type="text" name="attrs" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func24">
								<p><strong>dbupdate</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.dbupdate"><i class="icon-question-sign"></i></a>
								</p>
								<p>Обновляет записи в базе данных.</p>
								<label>Идентификатор соединения<span class="required">*</span></label>
								<input type="text" name="conn" class="span12" />
								<label>Таблица<span class="required">*</span></label>
								<input type="text" name="table" class="span12" />
								<label>Атрибуты (dict)<span class="required">*</span></label>
								<input type="text" name="attrs" class="span12" />
								<label>Атрибуты для условия (dict)<span class="required">*</span></label>
								<input type="text" name="whereattrs" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func25">
								<p><strong>dbdelete</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.dbdelete"><i class="icon-question-sign"></i></a>
								</p>
								<p>Удаляет записи из базы данных.</p>
								<label>Идентификатор соединения<span class="required">*</span></label>
								<input type="text" name="conn" class="span12" />
								<label>Таблица<span class="required">*</span></label>
								<input type="text" name="table" class="span12" />
								<label>Атрибуты для условия (dict)<span class="required">*</span></label>
								<input type="text" name="whereattrs" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func26">
								<p><strong>dbclose</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.dbclose"><i class="icon-question-sign"></i></a>
								</p>
								<p>Закрывает соединение с базой данных.</p>
								<label>Идентификатор соединения<span class="required">*</span></label>
								<input type="text" name="conn" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func27">
								<p><strong>mail</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.mail"><i class="icon-question-sign"></i></a>
								</p>
								<p>Отправляет письмо.</p>
								<label>Кому<span class="required">*</span></label>
								<input type="text" name="to" class="span12" />
								<label>Тема</label>
								<input type="text" name="subject" class="span12" />
								<label>Сообщение</label>
								<input type="text" name="body" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func28">
								<p><strong>filter_eqkeys</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.filtereqkeys"><i class="icon-question-sign"></i></a>
								</p>
								<p>Фильтрует ключи массивов, оставляя только элементы c ключами, которые присутствуют во всех массивах.</p>
								<label>Список переменных-массивов (id1, id2, ..., idn)<span class="required">*</span></label>
								<input type="text" name="data" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func29">
								<p><strong>group</strong>
									&nbsp;<a target="_blank"  href="/ru/docs/funcs.group"><i class="icon-question-sign"></i></a>
								</p>
								<p>Используется для группировки get-функций, использующих xpath.</p>
								<label>Имя группы<span class="required">*</span></label>
								<input type="text" name="name" class="span12"/>
																<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func30">
								<p><strong>getform</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.getform"><i class="icon-question-sign"></i></a>
								</p>
								<p>Получает параметры формы по заданному xpath. Допустимо только внутри loadpage.</p>
								<label>XPath<span class="required">*</span></label>
								<input type="text" name="xpath" class="span12"/>
																<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func31">
								<p><strong>submitform</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.submitform"><i class="icon-question-sign"></i></a></p>
								<p>Отправляет данные формы и загружает ответ.</p>
								<label>Форма<span class="required">*</span></label>
								<input type="text" name="form" class="span12"/>
								<label>Оригинальная кодировка</label>
								<input type="text" name="encoding" class="span12" value="" />
								<label>Заголовки (array)</label>
								<input type="text" name="headers" class="span12" value="" />
																<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func32">
								<p><strong>formgetparam</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.formgetparam"><i class="icon-question-sign"></i></a>
								</p>
								<p>Возвращает значение параметра формы.</p>
								<label>Форма<span class="required">*</span></label>
								<input type="text" name="form" class="span12" />
								<label>Имя параметра<span class="required">*</span></label>
								<input type="text" name="param" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func33">
								<p><strong>formsetparam</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.formsetparam"><i class="icon-question-sign"></i></a>
								</p>
								<p>Устанавливает параметр формы в заданное значение.</p>
								<label>Форма<span class="required">*</span></label>
								<input type="text" name="form" class="span12" />
								<label>Имя параметра<span class="required">*</span></label>
								<input type="text" name="param" class="span12" />
								<label>Значение<span class="required">*</span></label>
								<input type="text" name="value" class="span12" />
																<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func34">
								<p><strong>formgetselectkey</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.formgetselectkey"><i class="icon-question-sign"></i></a>
								</p>
								<p>Возвращает значение value одного из option элемента select по названию option.</p>
								<label>Форма<span class="required">*</span></label>
								<input type="text" name="form" class="span12" />
								<label>Имя select параметра<span class="required">*</span></label>
								<input type="text" name="param" class="span12" />
								<label>Название<span class="required">*</span></label>
								<input type="text" name="value" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func35">
								<p><strong>formgetselectvalue</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.formgetselectvalue"><i class="icon-question-sign"></i></a>
								</p>
								<p>Возвращает название option элемента select по значению value, заданному в option.</p>
								<label>Форма<span class="required">*</span></label>
								<input type="text" name="form" class="span12" />
								<label>Имя select параметра<span class="required">*</span></label>
								<input type="text" name="param" class="span12" />
								<label>Значение value<span class="required">*</span></label>
								<input type="text" name="value" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func36">
								<p><strong>gethtml</strong>
									&nbsp;<a target="_blank"  href="/ru/docs/funcs.gethtml"><i class="icon-question-sign"></i></a>
								</p>
								<p>Возвращает html код элемента, заданного xpath. Допустимо только внутри loadpage и submitform.</p>
								<label>XPath<span class="required">*</span></label>
								<input type="text" name="xpath" class="span12"/>
								<label>Опции</label>
								<input type="checkbox" name="content" />&nbsp;Возвращать только содержимое<br/>
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func37">
								<p><strong>removetags</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.removetags"><i class="icon-question-sign"></i></a>
								</p>
								<p>Убирает из строки заданные теги со всем содержимым. Возвращает новую строку.</p>
								<label>Строка с html<span class="required">*</span></label>
								<input type="text" name="html" class="span12" />
								<label>Теги для удаления (array)<span class="required">*</span></label>
								<input type="text" name="tags" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
							<div class="tab-pane" id="func38">
								<p><strong>basename</strong>
									&nbsp;<a target="_blank" href="/ru/docs/funcs.basename"><i class="icon-question-sign"></i></a>
								</p>
								<p>Возвращает имя файла, выделенное из пути.</p>
								<label>Путь (string | array)<span class="required">*</span></label>
								<input type="text" name="path" class="span12" />
								<br/>
								<button class="btn btn-success">Вставить</button>
							</div>
	    				</div>
    				</div>
				</div>
			</div>
			
			<div id="tabExport" class="tab-pane">
				<div id="exporttable">
					<h3>Профили экспорта</h3>
					<div style="margin-top: 20px;">
					<div class="span6">
					<table id="exporttbl" class="table table-striped table-bordered">
						<thead>
							<tr>
								<th>Имя</th>
								<th style="width: 100px;">Тип</th>
								<th style="width: 100px;">Расширение</th>
								<th style="width: 40px;"></th>
							</tr>
						</thead>
						<tbody>
								<tr>
								<td>csv</td>
								<td>csv</td>
								<td>csv</td>
								<td>
									<input type="hidden" name="exportid" value="1108" />
									<a class="edit" href="#" onclick="exportEdit(this);" title="Редактировать"><i class="icon-pencil"></i></a>
									<a class="delete" href="#" onclick="exportDelete(this);" title="Удалить"><i class="icon-trash"></i></a>
								</td>
							</tr>
						</tbody>
					</table>
					</div>
					<div class="span2">
						<div class="right-panel" style="margin-top: 0px;">
				    		<a href="#" onclick="exportNew();">Создать</a>
				    	</div>
				    	<div class="right-panel hint">Профили экспорта используются для задания шаблона сохранения собранных данных.</div>
					</div>
					</div>
				</div>
				<div id="exportedit">
					<h3>Создание нового профиля экспорта</h3>
					<h3>Редактирование профиля экспорта</h3>
					<input type="hidden" name="newedit" value="new" />
					<input type="hidden" name="exportType" value="csv" />
					<br/>
					<div class="tabbable">
						<ul class="nav nav-tabs" id="exportRadio">
							<li class="active"><a data-toggle="tab" href="#tabCSV">CSV</a></li>
							<li><a data-toggle="tab" href="#tabXML">XML</a></li>
							<li><a data-toggle="tab" href="#tabSQL">SQL</a></li>
							<li><a data-toggle="tab" href="#tabExcel">Excel</a></li>
							<li><a data-toggle="tab" href="#tabRDB">RDB</a></li>
						</ul>
						<div class="tab-content">
							<div id="tabCSV" class="tab-pane active">
								<label for="exportName">Имя профиля</label>
								<input type="text" id="exportName" value="" />
								<label for="exportExtension">Расширение файла</label>
								<input type="text" id="exportExtension" value="" />
								<label for="exportDelimiter">Разделитель</label>
								<input class="span1" type="text" id="exportDelimiter" value="" />
								<input type="checkbox" id="exportIssave" checked="checked"/>&nbsp;Записывать в файл<br/>
							</div>
							<div id="tabXML" class="tab-pane">
								<label for="exportName">Имя профиля</label>
								<input type="text" id="exportName" value="" />
								<label for="exportExtension">Расширение файла</label>
								<input type="text" id="exportExtension" value="" />
								<label for="exportTemplateHead">Шапка</label>
								<textarea id="exportTemplateHead" wrap="off" spellcheck="false"></textarea>
								<label for="exportTemplateBody">Шаблон записи</label>
								<textarea id="exportTemplateBody" wrap="off" spellcheck="false"></textarea>
								<label for="exportTemplateTail">Подвал</label>
								<textarea id="exportTemplateTail" wrap="off" spellcheck="false"></textarea>
								<br/>
								<input type="checkbox" id="exportIssave" checked="checked"/>&nbsp;Записывать в файл<br/>
							</div>
							<div id="tabSQL" class="tab-pane">
								<label for="exportName">Имя профиля</label>
								<input type="text" id="exportName" value="" />
								<label for="exportExtension">Расширение файла</label>
								<input type="text" id="exportExtension" value="" />
								<label for="exportTemplateHead">Шапка</label>
								<textarea id="exportTemplateHead" wrap="off" spellcheck="false"></textarea>
								<label for="exportTemplateBody">Шаблон записи</label>
								<textarea id="exportTemplateBody" wrap="off" spellcheck="false"></textarea>
								<label for="exportTemplateTail">Подвал</label>
								<textarea id="exportTemplateTail" wrap="off" spellcheck="false"></textarea>
								<br/>
								<input type="checkbox" id="exportIssave" checked="checked"/>&nbsp;Записывать в файл<br/>
							</div>
							<div id="tabExcel" class="tab-pane">
								<label for="exportName">Имя профиля</label>
								<input type="text" id="exportName" value="" />
								<label for="exportExtension">Расширение файла</label>
								<input type="text" id="exportExtension" value="" />
								<label for="exportTemplateHead">Шапка (здесь можно задать названия столбцов через ;)</label>
								<textarea id="exportTemplateHead" wrap="off" spellcheck="false"></textarea><br/>
								<input type="checkbox" id="exportinsimage" />&nbsp;Вставлять картинки<br/>
							</div>
							<div id="tabRDB" class="tab-pane">
								<div style="float: left; width: 300px;">
									<label for="exportName">Имя профиля</label>
									<input type="text" id="exportName" value="" />
									<label for="exportRDBType">База данных</label>
									<select id="exportRDBType">
									</select>
									<label for="exportDataset">Набор данных</label>
									<select id="exportDataset">
									</select>
									<br/><br/>
									<input type="checkbox" id="exportIssave" checked="checked"/>&nbsp;Записывать в БД<br/>
									<div id="dbparams">
										<label for="exportDBHost">Хост</label>
										<input type="text" id="exportDBHost" value="" />
										<label for="exportDBUser">Пользователь</label>
										<input type="text" id="exportDBUser" value="" />
										<label for="exportDBPass">Пароль</label>
										<input type="text" id="exportDBPass" value="" />
										<label for="exportDBName">Имя базы данных</label>
										<input type="text" id="exportDBName" value="" />
									</div>
								</div>
								<div id="rdbview" style="float: left">
								</div>
							</div>
						</div>
					</div>
					<hr/>
					<div class="myformbtns">
						<button class="btn" onclick="exportEditOk();">OK</button>
						<button class="btn" onclick="exportEditCancel();">Отмена</button>
					</div>
				</div>
			</div>
			
		</div>
	</div>
						
						
					</div>
					<div class="modal-footer">
					<!--	<a data-dismiss="modal" id="add-btn" class="btn" href="/create/" >OK</a>    <a data-dismiss="modal" id="cancel-del-btn" class="btn" href="#">Отмена</a> -->
					</div>
				</div>				
<!-- EDIT-->			

					</div>
					<div class="span2">
						<div class="right-panel">
							<a href="/main/create"  class="create" rel="tooltip"  data-original-title="Create"><i class="icon-plus"></i>&nbsp;Создать парсер</a>		</div>
						<div class="right-panel hint">
							Это список ваших парсеров.		</div>	
					</div>
				</div>
				



				
				</div>
			</div>
</div>


<div id="closeModal" class="modal fade">
	<div class="modal-header">
		<a class="close" data-dismiss="modal">&times;</a>
		<h3>Закрытие</h3>
	</div>
	 
	<div class="modal-body">
		<p>Сохранить изменения?</p>
		<div class="popup3" style="margin-left: 45%; top: 40%;"><img src="images/ajax-loader2.gif" /></div>
	</div>
	 
	<div class="modal-footer">
		<a id="yes-close-btn" data-url="#/main" class="btn" href="#">Да</a>    
		<a data-dismiss="modal" id="no-close-btn" data-url="/main" class="btn" href="#">Нет</a>
		<a data-dismiss="modal" id="cancel-close-btn" class="btn" href="#">Отмена</a>
	</div>
</div>


<div id="delexpModal" class="modal fade">
	<div class="modal-header">
		<a class="close" data-dismiss="modal">&times;</a>
		<h3>Удаление профиля экспорта</h3>
	</div>
	<div class="modal-body">
		<p>Вы действительно хотите удалить профиль экспорта?</p>
	</div>
	<div class="modal-footer">
		<a data-dismiss="modal" id="ok-del-exp" class="btn" href="#">OK</a>    <a data-dismiss="modal" id="cancel-del-exp" class="btn" href="#">Отмена</a>
	</div>
</div>

<div id="delpageexpModal" class="modal fade">
	<div class="modal-header">
		<a class="close" data-dismiss="modal">&times;</a>
		<h3>Удаление правила экспорта</h3>
	</div>
	<div class="modal-body">
		<p>Вы действительно хотите удалить правило экспорта?</p>
	</div>
	<div class="modal-footer">
		<a data-dismiss="modal" id="ok-del-exppage" class="btn" href="#">OK</a>    <a data-dismiss="modal" id="cancel-del-exppage" class="btn" href="#">Отмена</a>
	</div>
</div>


<div id="loader" class="popup2">
	<img src="images/ajax-loader2.gif" />
</div>

	</div>
	
		
	<div class="hFooter"></div>
</div>

<div id="footer">Copyright &copy; 2013-2014 ScraperLab.com <span style="display: inline-block; width:50px;"></span><a href="mailto:support@scraperlab.com">support@scraperlab.com</a></div>



<script type="text/javascript" src="js/vars.js" ></script>
<script type="text/javascript" src="js/module.js" ></script>
<script type="text/javascript" src="js/obj.js" ></script>
<script type="text/javascript" src="js/main-rules.js" ></script>
<script type="text/javascript" src="js/events.js" ></script>

<script type="text/javascript" >

if(!supports_html5_storage()){
	alert('обновите браузер');
}

/**********************************/


var idField = $('#id-field');
var nameField = $('#name-field');
var urlField = $('#url-field');
var addBtn = $('#add-btn');
//var editBtn = $('#edit-btn');
var removeBtns = $('.remove-item-btn');
var search = $('.search');
/*
editBtn.click(function() {
	alert('as');
});
*/

addParseList();
refreshCallbacks();

addBtn.click(function() {

	_PARSE.id = Math.floor(Math.random()*110000);
	_PARSE.url = urlField.val();
	_PARSE.name = nameField.val();
	_PARSE.date_edit = new Date().yyyymmdd();
	
	var parser = getlocalStorageParser();
	parser[_PARSE.name] = {
		'id' : _PARSE.id,
		'url' : _PARSE.url,
		'name' : _PARSE.name,
		'date_edit' : _PARSE.date_edit
	};

	parseList.add(parser[_PARSE.name]);
	
	setlocalStorageParser(parser); 	

	clearFields();
	refreshCallbacks();
});



function refreshCallbacks() {
	// Needed to add new buttons to jQuery-extended object
	removeBtns = $(removeBtns.selector);

	removeBtns.click(function() {
		var itemId = _PARSE.id;
		parseList.remove('id', itemId);
		clearFields();
	});
  
	$('a.delete').click(function(e) {
		e.preventDefault();
		var itemId = $(this).closest('tr').find('.id').text();
		_PARSE.id = itemId;		
		//$('#deleteModal').find('#ok-del-btn').attr('href', $(this).attr('href'));
		$('#deleteModal').modal('show');
	}); 
	
	$('a.edit').click(function(e) {
		e.preventDefault();
		var itemId = $(this).closest('tr').find('.id').text();
		_PARSE.id = itemId;
		_PARSE.url = $(this).closest('tr').find('.url').text();
		_PARSE.name = $(this).closest('tr').find('.name').text();
		var parser = getlocalStorageParser();
		if(parser[_PARSE.name] && parser[_PARSE.name]['html']){
			_PARSE.html = parser[_PARSE.name]['html'];
		}else{
			_PARSE.html = DEF_TPL;
		}
		var html = populateIframe('html', _PARSE.html);
		setEvenHoveredAll(html);
		$('.js_items').attr('id','js_items_'+_PARSE.id);
		if(parser[_PARSE.name].rule.data){
			console.log(parser[_PARSE.name].rule.data);
			PARSE_RULE.createTree(parser[_PARSE.name].rule.data);
		}
		//addBaseTag(getIframeContent('html'), _PARSE.url)
		$('#editModal').addClass(' js_id_'+itemId);
		$('#editModal').modal('show');
	});

	$('#js_base_btn').change(function() {
        if($(this).is(":checked")) {
            addBaseTag(getIframeContent('html'), _PARSE.url);
			var html = populateIframe('html', getIframeContent('html').body.innerHTML);
			setEvenHoveredAll(html);
        }else{
			delBaseTag(getIframeContent('html'));
			var html = populateIframe('html', getIframeContent('html').body.innerHTML);
			setEvenHoveredAll(html);
		}    
    });
}

function clearFields() {
	nameField.val('');
	urlField.val('');
	_PARSE.id = null;
	_PARSE.url = null;
	_PARSE.name = null;
	_PARSE.html = null;
}
$('a.create').click(function(e) {
	e.preventDefault();
	$('#createModal').modal('show');
});

bindModelInput(_PARSE, 'url', document.getElementById('js_url'));
bindModelInput(_PARSE, 'name', document.getElementById('js_name'));
bindModelInput(_PARSE, 'html', document.getElementById('js_tpl'));
bindModelInput(_PARSE, 'date_edit', null);
bindModelInput(_PARSE, 'id', null);
bindModelInput(_PARSE, 'rule', null);


$('#js_add_rule').click(function(){
	PARSE_RULE.add();
});

document.getElementById('js_tpl').onchange = function(){
	var text = document.getElementById("js_tpl").value;
	_PARSE.html = text;
	
	var data = getlocalStorageParser();
	data[_PARSE.name]['html'] = text;
	setlocalStorageParser(data)
	/*
	var iframe = document.getElementById('html');
	iframe.contentWindow.contents = text;
	iframe.src = 'javascript:window.contents';
	*/
	var html = populateIframe('html', _PARSE.html);
	setEvenHoveredAll(html);
	//addBaseTag(getIframeContent('html'), _PARSE.url)
	return true;		
}


	/*
	$('#deleteModal').find('#ok-del-btn').click(function() {
		location.href = $(this).attr('href');
	});
	*/

$(document).on('click','.xpath',function(){ 
    $('#selxpath').css('background','#fff');
    $('#selxpath').attr('id','');        
    $(this).attr('id','selxpath');
    $(this).css('background','rgb(253, 0, 0) !important');
}); 	


   
	
var PARSE_RULE = function() {
    var cnt = 0;
    var scnt = 0;
    this.xpath = null;
	this.name = null;
	this.type = null;

    function createItem() {
        scnt++;
	    var id = 'div#tree_item_'+scnt+'';
        var _xpath = 'xpath';
        var _name = 'name';
        var _type = 'type';
	    return v(id, {}, [ 
	            v('input.form-control.type.selattr',{name:_type,'disabled':"disabled"}),
	            v('input.form-control.name',{type:'text',placeholder:'Name',name:_name,'disabled':"disabled"}),
	            v('input.form-control.xpath',{type:'text',placeholder:'Xpath',name:_xpath,'disabled':"disabled"}),
	            v("button.btn.btn-default#edit_item", { onclick: editItem, 'data-id':id}, "EditItem"),
	            v('button.btn.del',{type:'button'},'&times;'),
	    ]);
    };
	function setValTree(el,key,val){
		el.querySelector('.'+key).value = val;
	}    
	function createTreeItem(data,parent_id){
		
        if(!tree){
            tree = new VanillaTree( '#js_items_'+_PARSE.id, {});         
        }
		for(var i in data){
			tree.add({
			  el: createItem(),
			  id: 'tree_'+scnt,
			  opened: true,
			  parent :parent_id,
			});
			var el = document.querySelector('#tree_item_' + scnt);
			for(var key in data[i]){
				if(key == 'children') continue;
				setValTree(el,key,data[i][key])
			}
			if(data[i].children){
				createTree(data[i].children,'tree_'+scnt);
			}
		}

	};
	
    addSubItem = function(e){
        //e = e || event;
        //var target = e.target || e.srcElement;
        //var d_id = '#'+$(target).parent().attr('id');
		if(tree){
				//var tree = new VanillaTree( d_id, {});
				tree.add({
				  el: createItem(),
				  id: 'tree_'+scnt,
				  label:'aa'+scnt,
				  parent :_selID,
				  opened: true
				}); 
				return scnt;
		  }
			return null;
    };
    var tree = undefined;
    var _selID = undefined;
    addItem = function(e){
        if(!tree){
            tree = new VanillaTree( '#js_items_'+_PARSE.id, {});
            document.querySelector('#js_items_'+_PARSE.id).addEventListener('vtree-select', function(evt) {
                _selID = evt.detail.id;
            });            
        }
        tree.add({
          el: createItem(),
          id: 'tree_'+scnt,
          opened: true
        });
		return scnt; 
    };
	
	editItem = function (){
		alert($(this).attr('data-id'));
	}
	
    this.add = function(parent){
		_selID = parent;
		//$('.js_items').attr('id','js_items_'+_PARSE.id);
		if(_selID){
			return addSubItem();
		}else{
			return addItem();
		}
    };
	
	this.createTree = function(data,parent_id){
		createTreeItem(data,parent_id);
	}
    this.seltype = [
        '',
        'link',
        'text',
        'html',
        'img',
        'table',
    ];
	return this;

}();
	
/**********************************/
/*<![CDATA[*/


var ECTTemplates = {'exportlistformatrow': '<tr>\n	<td><%- @i %></td>\n	<td><%= @e.name %></td>\n	<td><%= @e.type %></td>\n	<% retvar = if @e.retvarname then @e.retvarname+\' = \' else \'\' %>\n	<td><%= retvar %>store(\'<%= @e.name %>\', \'<%= @e.filename %>\', <%= @e.paramstype %>(...));</td>\n	<td>\n		<input type="hidden" name="exportid" value="<%- @i %>" />\n		<a class="edit" href="#" onclick="pageExportListEdit(this);" title="<%= @Lang.t \'Редактировать\' %>"><i class="icon-pencil"></i></a>\n		&nbsp;\n		<a class="up" href="#" onclick="pageExportListUp(this);" title="<%= @Lang.t \'Переместить вверх\' %>"><i class=" icon-arrow-up"></i></a>\n		<a class="down" href="#" onclick="pageExportListDown(this);" title="<%= @Lang.t \'Переместить вниз\' %>"><i class=" icon-arrow-down"></i></a>\n		&nbsp;\n		<a class="delete" href="#" onclick="pageExportListDelete(this);" title="<%= @Lang.t \'Удалить\' %>"><i class="icon-trash"></i></a>\n	</td>\n</tr>',
'exportlistformattable': '<% for e, i in @exp : %>\n	<% include \'exportlistformatrow\', {i: i, e: e, Lang: @Lang} %>\n<% end %>',
'exportpageformatarray': '<% num = 1 %> \n<% for elem in @array : %>\n	<% include \'exportpageformatarrayrow\', {num: num, elem: elem, rules: @rules, vartypes: @vartypes[num-1], Lang: @Lang} %>\n	<% num++ %> \n<% end %>',
'exportpageformatarrayrow': '<tr>\n	<td style="width: 100px;"><%- @num %></td>\n	<td>\n		<% include \'exportpagevarselect\', {elem: @elem, rules: @rules, vartypes: @vartypes, Lang: @Lang} %>\n	</td>\n	<td style="width: 100px;">\n		<a href="#" onclick="pageExportUp(this);" title="<%= @Lang.t \'Переместить вверх\' %>"><i class="icon-arrow-up"></i></a>\n		<a href="#" onclick="pageExportDown(this);" title="<%= @Lang.t \'Переместить вниз\' %>"><i class="icon-arrow-down"></i></a>\n	</td>\n	<td style="width: 50px;">\n		<a href="#" onclick="pageExportItemDelete(this);" title="<%= @Lang.t \'Удалить\' %>"><i class="icon-trash"></i></a>\n	</td>\n</tr>',
'exportpageformatdict': '<% for var1, elem of @array : %>\n<tr>\n	<% matches = var1.match /^(.+?)(\\*?)$/ %>\n	<% span = if matches[2] != \'\' then \'<span>*</span>\' else \'\'	%>\n	<td style="width: 250px"><%= matches[1] %><%- span %></td>\n	<td style="width: 30px">=&gt;</td>\n	<td>\n		<% include \'exportpagevarselect\', {elem: elem, rules: @rules, vartypes: @vartypes[var1], Lang: @Lang} %>\n	</td>\n</tr>\n<% end %>',
'exportpagevarselect': '<select name="rulename">\n<% section = 0 %>\n<% for rule in @rules : %>\n	<% if @vartypes == \'var\' && rule.name == @elem : %>\n		<% selected = \'selected="selected"\' %>\n	<% else : %>\n	  	<% selected = \'\' %>\n	<% end %>\n	\n	<% if section == 0 && rule.isrule && !rule.global : %>\n		<% section = 1 %>\n		<option value="" style="font-weight: bold;">--<%= @Lang.t \'Правила\' %>:</option>\n	<% else if section == 1 && !rule.isrule && !rule.global : %>\n		<% section = 2 %>\n		<option value="" style="font-weight: bold;">--<%= @Lang.t \'Переменные\' %>:</option>\n	<% else if section == 2 && rule.global : %>\n		<% section = 3 %>\n		<option value="" style="font-weight: bold;">--<% @Lang.t \'Глобальные\' %>:</option>\n	<% end %>\n	\n	<option value="<%= rule.name %>" <%= selected %>><%= rule.name %> (<%= rule.type %>)</option>\n<% end %>\n<% if @vartypes == \'const\' : %>\n	<option value="{const}" selected="selected" style="font-weight: bold;"><%= @Lang.t \'Константа\' %></option>\n	</select>\n	<input type="text" name="const" value="<%= @elem %>" />\n<% else : %>\n	<option value="{const}" style="font-weight: bold;"><%= @Lang.t \'Константа\' %></option>\n	</select>\n	<input type="text" name="const" style="display: none" />\n<% end %>',
'pagedataformat': '<ul class="nav nav-tabs" style="margin-bottom: 0px;">\n	<% num = 1 %>\n	<% for group, rules of @data : %>\n		<% active = if num == 1 then \' class="active"\' else \'\' %>\n		<li<%- active %> title="<%= @Lang.t \'Группа\' %>"><a href="#tab<%- num++ %>" data-toggle="tab"><%= group %></a></li>\n	<%end %>\n</ul>\n<div class="tab-content" style="overflow: auto; width: 100%; height: 95%; border: 1px solid #DDDDDD; border-top: none; paddin-top: 5px;">\n	<% num = 1 %>\n	<% for group, table of @data : %>\n		<% active = if num == 1 then \' active\' else \'\' %>\n		<div class="tab-pane<%- active %>" id="tab<%- num++ %>">\n			<table class="table table-striped table-condensed" style="width: <%- @totallen[group] %>px; max-width: none;">\n				<thead>\n					<tr><td>#</td>\n					<% for hname, hvalue of @headers[group] : %>\n						<td title="<%= @Lang.t \'Имя правила\' %>"><strong><%= hname %></strong></td>\n					<% end %>\n					</tr>\n				</thead>\n				<tbody>\n					<% for line in table : %>\n						<tr>\n						<% for rname, rvalue of line : %>\n							<td><%= rvalue.val %>\n								<% if rvalue.type == \'image\' : %>\n									<br/><img src="<%- rvalue.val %>" height="100" />\n								<% end %>\n							</td>\n						<% end %>\n						</tr>\n					<% end %>\n				</tbody>\n			</table>\n		</div>\n	<% end %>\n</div>',
'ruleformatrow': '<tr id="rule-<%= @rule.name %>">\n	<td><input type="checkbox" name="checkbox" /></td>\n	<td><%= @rule.name %></td>\n	<td><% if @rule.type == \'text\' : %>\n			<span class="label" id="text"><%= @Lang.t \'Текст\' %></span>\n		<% else if @rule.type == \'link\' : %>\n			<span class="label" id="link"><%= @Lang.t \'Ссылка\' %></span>\n		<% else if @rule.type == \'image\' : %>			\n			<span class="label" id="image"><%= @Lang.t \'Картинка\' %></span> \n		<% else if @rule.type == \'form\' : %>			\n			<span class="label" id="form"><%= @Lang.t \'Форма\' %></span>\n		<% else if @rule.type == \'regexp\' : %>			\n			<span class="label" id="regexp">RegExp</span>\n		<% else if @rule.type == \'html\' : %>			\n			<span class="label" id="htmltype">HTML</span>\n		<% end %>\n	</td>\n	<td><%= @rule.group %></td>\n	<td><%= @rule.path %></td>\n	<td>\n		<div class="btn-group">\n			<button class="btn btn-mini dropdown-toggle" data-toggle="dropdown2">\n				<%= @Lang.t \'Действия\' %> <span class="caret"></span>\n			</button>\n			<ul class="dropdown-menu">\n				<% if @type != \'form\': %>\n					<% if @rule.type == \'regexp\': %>\n						<li><a href="#" onclick="getregexp(this);"><%= @Lang.t \'Параметры\' %></a></li>\n					<% else: %>\n						<li><a href="#" onclick="ruleoptions(this);"><%= @Lang.t \'Параметры\' %></a></li>\n					<% end %>\n					<li><a href="#" onclick="rulesetgroup(this);"><%= @Lang.t \'Группировка\' %></a></li>\n					<li><a href="#" onclick="rulefilter(this);"><%= @Lang.t \'Фильтр\' %></a></li>\n				<% end %>\n				<% if @rule.type == \'link\' or @rule.type == \'form\' or @rule.type == \'html\': %>\n					<li><a href="#" onclick="ruleload(this);"><%= @Lang.t \'Загрузить\' %></a></li>\n				<% end %>\n				<% if @rule.type != \'form\' and @rule.type != \'regexp\': %>\n					<li><a href="#" onclick="htmltree(this);"><%= @Lang.t \'Редактировать XPath\' %></a></li>\n				<% end %>\n			</ul>\n		</div>\n	</td>\n	\n</tr>',
'ruleformattable': '<% for rule in @array : %>\n	<% include \'ruleformatrow\', {rule: rule, Lang: @Lang} %>\n<% end %>',
};
jQuery(function($) {
jQuery('a[rel="tooltip"]').tooltip();
jQuery('a[rel="popover"]').popover();
jQuery('#closeModal').modal({'show':false});
jQuery('#delexpModal').modal({'show':false});
jQuery('#delpageexpModal').modal({'show':false});
});

/*]]>*/
</script>

</body>
</html>
