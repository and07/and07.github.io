<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>CPALAB</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="SuggeElson" />
        <meta name="description" content="Genyx admin template - new premium responsive admin template. This template is designed to help you build the site administration without losing valuable time.Template contains all the important functions which must have one backend system.Build on great twitter boostrap framework" />
        <meta name="keywords" content="admin, admin template, admin theme, responsive, responsive admin, responsive admin template, responsive theme, themeforest, 960 grid system, grid, grid theme, liquid, jquery, administration, administration template, administration theme, mobile, touch , responsive layout, boostrap, twitter boostrap" />
        <meta name="application-name" content="Genyx admin template" />

        <!--[if lt IE 9]> 
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:400" rel="stylesheet" type="text/css" />
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:700" rel="stylesheet" type="text/css" />
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:800" rel="stylesheet" type="text/css" />
        <link href="http://fonts.googleapis.com/css?family=Droid+Sans:400" rel="stylesheet" type="text/css" />
        <link href="http://fonts.googleapis.com/css?family=Droid+Sans:700" rel="stylesheet" type="text/css" />
        <![endif]--> <!-- Core stylesheets do not remove -->
        <link href="css/bootstrap/bootstrap.css" rel="stylesheet" />
        <link href="css/bootstrap/bootstrap-responsive.css" rel="stylesheet" />
        <link href="css/bootstrap/bootstrap-datetimepicker.min.css" rel="stylesheet" />
        <link href="css/icons.css" rel="stylesheet" />
        <!-- Plugins stylesheets --> 
        <link href="js/plugins/misc/fullcalendar/fullcalendar.css" rel="stylesheet" />
        <link href="js/plugins/forms/uniform/uniform.default.css" rel="stylesheet" />
        <link href="js/plugins/ui/jgrowl/jquery.jgrowl.css" rel="stylesheet" />
        <!-- app stylesheets --> 
        <link href="css/app.css" rel="stylesheet" />
        <!-- Custom stylesheets ( Put your own changes here ) --> 

        <!--[if IE 8]>
        <link href="css/ie8.css" rel="stylesheet" type="text/css" />
        <![endif]--> <!-- HTML5 shim, for IE6-8 support of HTML5 elements --> <!--[if lt IE 9]> <script src="js/html5shiv.js"></script> <![endif]--> <!-- Fav and touch icons --> 
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="images/ico/apple-touch-icon-144-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/ico/apple-touch-icon-114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="images/ico/apple-touch-icon-72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" href="images/ico/apple-touch-icon-57-precomposed.png">
        <link rel="shortcut icon" href="images/ico/favicon.png">
        <!-- Le javascript ================================================== --> 
        <!-- Important plugins put in all pages --> 
        
<script>
var server = 'http://localhost:8888';
</script>          
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> 
        <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script> 
        <script src="js/conditionizr.min.js"></script> 
        <script src="js/moment.min.js"></script>
        <script src="js/bootstrap/bootstrap.js"></script>
        <script src="js/bootstrap/bootstrap-datetimepicker.min.js"></script>
        <script src="js/plugins/core/nicescroll/jquery.nicescroll.min.js"></script> 
        <script src="js/plugins/core/jrespond/jRespond.min.js"></script> 
        <script src="js/jquery.genyxAdmin.js"></script> <!-- Charts plugins --> 
        <script src="js/plugins/charts/flot/jquery.flot.js"></script> 
        <script src="js/plugins/charts/flot/jquery.flot.pie.js"></script> 
        <script src="js/plugins/charts/flot/jquery.flot.resize.js"></script> 
        <script src="js/plugins/charts/flot/jquery.flot.tooltip.min.js"></script> 
        <script src="js/plugins/charts/flot/jquery.flot.orderBars.js"></script> <script src="js/plugins/charts/flot/jquery.flot.time.min.js"></script> <script src="js/plugins/charts/sparklines/jquery.sparkline.min.js"></script> <script src="js/plugins/charts/flot/date.js"></script> <!-- Only for generating random data delete in production site--> <script src="js/plugins/charts/pie-chart/jquery.easy-pie-chart.js"></script> <script src="js/plugins/charts/gauge/justgage.1.0.1.min.js"></script> <script src="js/plugins/charts/gauge/raphael.2.1.0.min.js"></script> 
        <!-- Form plugins --> <script src="js/plugins/forms/uniform/jquery.uniform.min.js"></script>
         <!-- Misc plugins --> <script src="js/plugins/misc/fullcalendar/fullcalendar.min.js"></script> 
         <!-- UI plugins --> 
         <script src="js/plugins/ui/jgrowl/jquery.jgrowl.min.js"></script> 
         <!-- Init plugins --> 
        <!-- Form plugins -->
        <script src="js/plugins/forms/validation/jquery.validate.js"></script>
        <!-- Init plugins -->
        <script src="js/app.js"></script>
        <!-- Core js functions -->
<link href="js/vanillatree/vanillatree.css" rel="stylesheet" />        
<script src="js/vanillatree/vanillatree.js"></script>

  
    <script src="js/app/event.js"></script>
    <script src="js/app/list.js"></script>
    <script src="js/app/list.pagination.js"></script>
    <!--script src="js/app/routie.js"></script-->
    <script src="js/app/router.js"></script>
    <script src="js/app/popupmenu.js"></script>
    <script src="js/app/mithril.js"></script>
	<script src = "js/app/mediator.js" type="text/javascript"></script>
	<script src = "js/app/module.js" type="text/javascript"></script>
	<script src = "js/app/repeatable.js" type="text/javascript"></script>
	<script src = "js/app/data_test.js" type="text/javascript"></script>
	<script src="js/app/common.js"></script>
	<script src="js/app/modalwin.js"></script>
	<link src="css/modalwin.css" rel="stylesheet">
	<script src="js/app/parse.js"></script>
	<link href="css/parse.css" rel="stylesheet" />
	<script src="js/app/chartkick.js"></script>
        <!-- Core js functions --> 
        <!--script src="js/pages/dashboard.js"></script-->
        <!-- Init plugins only for page -->
    </head>
<style>
.pagination li {
  display:inline-block;
  padding:5px;
}
#center {
	top: 50% !important; /* Отступ в процентах от верхнего края окна */
	left: 50% !important; /* Отступ в процентах от левого края окна */
	width: 450px !important; /* Ширина блока */
	height: 450px !important; /* Высота блока */
	position: absolute !important; /* Абсолютное позиционирование блока */
	margin-top: -225px !important; /* Отрицательный отступ от верхнего края страницы, должен равняться половине высоты блока со знаком минус */
	margin-left: -225px !important; /* Отрицательный отступ от левого края страницы, должен равняться половине высоты блока со знаком минус */
}
</style> 
    <body>
<div id="js_cpalab_title_tpl"></div>     
<div id="js_auth_tpl"></div>    
<div id="js_main_tpl" style="display:none">
        <header id="header" class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="brand" href="#dashboard"><img src="images/logo.png" alt="Genyx admin"></a> 
                    <div class="nav-no-collapse">
                        <div id="top-search">
                            <form action="#" method="post" class="form-search">
                                <div class="input-append"> <input type="text" name="tsearch" id="tsearch" placeholder="Search here ..." class="search-query"> <button type="submit" class="btn"><i class="icon16 i-search-2 gap-right0"></i></button> </div>
                            </form>
                        </div>
                        <ul class="nav pull-right">
                            <li class="divider-vertical"></li>
                            <li class="dropdown user">
                                <a href="#" class="dropdown-toggle avatar i-user" data-toggle="dropdown">  <span class="more"><i class="icon16 i-arrow-down-2"></i></span> </a> 
                                <ul class="dropdown-menu">
                                    <li><a href="#settings" class=""><i class="icon16 i-cogs"></i> Settings</a></li>
                                    <li><a href="#profile" class=""><i class="icon16 i-user"></i> Profile</a></li>
                                    <li><a href="#/logout/" class=""><i class="icon16 i-exit"></i> Logout</a></li>
                                </ul>
                            </li>
                            <li class="divider-vertical"></li>
                        </ul>
                    </div>
                    <!--/.nav-collapse --> 
                </div>
            </div>
        </header>
        <!-- End #header --> 
        <div class="main">
            <aside id="sidebar">
                <div class="side-options">
                    <ul>
                        <li><a id="collapse-nav" class="act act-primary tip" title="Collapse navigation"><i class="icon16 i-arrow-left-7"></i></a></li>
                    </ul>
                </div>
                <div class="sidebar-wrapper">
                    <nav id="mainnav">
                        <ul class="nav nav-list">
                            <li> <a href="#/dashboard/"> <span class="icon"><i class="icon20 i-screen"></i></span> <span class="txt">Dashboard</span> </a> </li>
                            <li> <a href="#/screenshot/"> <span class="icon"><i class="icon20 i-screen"></i></span> <span class="txt">ScreenShot</span> </a> </li>
                            <li> <a href="/imagemaker.html"> <span class="icon"><i class="icon20 i-screen"></i></span> <span class="txt">ImageMaker</span> </a> </li>
                         <li> <a href="#/partners-cpa/"> <span class="icon"><i class="icon20 i-grid-5"></i></span> <span class="txt">Партнерки CPA</span> </a> </li>
                                                      
                            <li> <a href="#/statistics/"> <span class="icon"><i class="icon20 i-stats-up"></i></span> <span class="txt">Статистика</span> </a> </li>
                            
                            <li> <a class="js_sub_btn"> <span class="icon"><i class="icon20 i-grid-5"></i></span> <span class="txt">Парсер</span> </a>
                             <ul class="sub">
                                    <li> <a href="#/parser-html-xml/"> <span class="icon"><i class="icon20 i-table"></i></span> <span class="txt">HTML</span> </a> </li>
                                    <li> <a href="#/parser-rules/"> <span class="icon"><i class="icon20 i-user"></i></span> <span class="txt">RULE</span> </a> </li>    
<li> <a href="#/group-vk/"> <span class="icon"><i class="icon20 i-user"></i></span> <span class="txt">VK</span> </a> </li>    
                                
                                </ul>
                        </li>
<li> 
<a class="js_sub_btn"> <span class="icon"><i class="icon20 i-cogs"></i></span> <span class="txt">Настройки</span> </a> 
    <ul class="sub">
         <li> <a href="#/users/"> <span class="icon"><i class="icon20 i-user"></i></span> <span class="txt">Users</span> </a> </li>
         <li> <a href="#/groups/"> <span class="icon"><i class="icon20 i-user"></i></span> <span class="txt">Groups</span> </a> </li>
         <li> <a href="#/partners/"> <span class="icon"><i class="icon20 i-user"></i></span> <span class="txt">Partners</span> </a> </li>
    </ul> 
</li>                              
                            
                            
                            <li> <a href="#charts"> <span class="icon"><i class="icon20 i-stats-up"></i></span> <span class="txt">Charts</span> </a> </li>
                            <li> <a class="js_sub_btn"> <span class="icon"><i class="icon20 i-envelop-2"></i></span> <span class="txt">Mailer</span> </a> 
                                <ul class="sub">
                                    <li> <a href="#/mailer/"> <span class="icon"><i class="icon20 i-stack-list"></i></span> <span class="txt">Рассылки</span> </a> </li>
                                    <li> <a href="#/mailer_banner/"> <span class="icon"><i class="icon20 i-stack-checkmark"></i></span> <span class="txt">Рекламные блоки</span> </a> </li>
                                    <li><a href="#/mailer_template/"> <span class="icon"><i class="icon20 i-stack-empty"></i></span> <span class="txt">Почтовые шаблоны</span> </a></li>
                                    <li><a href="#/mailer_type/"> <span class="icon"><i class="icon20 "></i></span> <span class="txt">Тип письма</span> </a></li>
                                    <li> <a href="#/mailer_api_key/"> <span class="icon"><i class="icon20 i-key-2"></i></span> <span class="txt">Ключи API</span> </a> </li>
                                </ul>                            
                            </li>
                            <li>
                                <a class="js_sub_btn"> <span class="icon"><i class="icon20 i-menu-6"></i></span> <span class="txt">Forms</span> </a> 
                                <ul class="sub">
                                    <li> <a href="form-elements.html"> <span class="icon"><i class="icon20 i-stack-list"></i></span> <span class="txt">Form elements</span> </a> </li>
                                    <li> <a href="form-validation.html"> <span class="icon"><i class="icon20 i-stack-checkmark"></i></span> <span class="txt">Form validation</span> </a> </li>
                                    <li> <a href="form-wizard.html"> <span class="icon"><i class="icon20 i-stack-star"></i></span> <span class="txt">Form wizard</span> <span class="notification red">4</span> </a> </li>
                                </ul>
                            </li>
                            <li>
                                <a href="#" class="js_sub_btn"> <span class="icon"><i class="icon20 i-table-2"></i></span> <span class="txt">Tables</span> </a> 
                                <ul class="sub">
                                    <li> <a href="tables.html"> <span class="icon"><i class="icon20 i-table"></i></span> <span class="txt">Static tables</span> </a> </li>
                                    <li> <a href="data-tables.html"> <span class="icon"><i class="icon20 i-table"></i></span> <span class="txt">Data tables</span> </a> </li>
                                </ul>
                            </li>
                            <li> <a href="grid.html"> <span class="icon"><i class="icon20 i-grid-5"></i></span> <span class="txt">Grid</span> </a> </li>
                            <li> <a href="typo.html"> <span class="icon"><i class="icon20 i-font"></i></span> <span class="txt">Typography</span> </a> </li>
                            <li> <a href="calendar.html"> <span class="icon"><i class="icon20 i-calendar"></i></span> <span class="txt">Calendar</span> </a> </li>
                            <li>
                                <a href="#" class="js_sub_btn"> <span class="icon"><i class="icon20 i-cogs"></i></span> <span class="txt">Ui Elements</span> </a> 
                                <ul class="sub">
                                    <li> <a href="#icons"> <span class="icon"><i class="icon20 i-IcoMoon"></i></span> <span class="txt">Icons</span> </a> </li>
                                    <li> <a href="buttons.html"> <span class="icon"><i class="icon20 i-point-up"></i></span> <span class="txt">Buttons</span> </a> </li>
                                    <li> <a href="ui-elements.html"> <span class="icon"><i class="icon20 i-puzzle"></i></span> <span class="txt">UI Elements</span> </a> </li>
                                </ul>
                            </li>
                            <li> <a href="gallery.html"> <span class="icon"><i class="icon20 i-images"></i></span> <span class="txt">Gallery</span> </a> </li>
                            <li> <a href="maps.html"> <span class="icon"><i class="icon20 i-location-4"></i></span> <span class="txt">Maps</span> <span class="notification green">6</span> </a> </li>
                            <li> <a href="file-manager.html"> <span class="icon"><i class="icon20 i-cloud-upload"></i></span> <span class="txt">File manager</span> </a> </li>
                            <li> <a href="widgets.html"> <span class="icon"><i class="icon20 i-cube-3"></i></span> <span class="txt">Widgets</span> <span class="notification">26</span> </a> </li>
                            <li>
                                <a href="#" class="js_sub_btn"> <span class="icon"><i class="icon20 i-file-8"></i></span> <span class="txt">Pages</span> </a> 
                                <ul class="sub">
                                    <li>
                                        <a href="#" class="js_sub_btn"> <span class="icon"><i class="icon20 i-warning"></i></span> <span class="txt">Error Pages</span> </a> 
                                        <ul class="sub">
                                            <li> <a href="403.html"> <span class="icon"><i class="icon20 i-notification"></i></span> <span class="txt">Error 403</span> </a> </li>
                                            <li> <a href="404.html"> <span class="icon"><i class="icon20 i-notification"></i></span> <span class="txt">Error 404</span> </a> </li>
                                            <li> <a href="405.html"> <span class="icon"><i class="icon20 i-notification"></i></span> <span class="txt">Error 405</span> </a> </li>
                                            <li> <a href="500.html"> <span class="icon"><i class="icon20 i-notification"></i></span> <span class="txt">Error 500</span> </a> </li>
                                            <li> <a href="503.html"> <span class="icon"><i class="icon20 i-notification"></i></span> <span class="txt">Error 503</span> </a> </li>
                                            <li> <a href="offline.html"> <span class="icon"><i class="icon20 i-notification"></i></span> <span class="txt">Offline page</span> </a> </li>
                                        </ul>
                                    </li>
                                    <li> <a href="invoice.html"> <span class="icon"><i class="icon20 i-credit"></i></span> <span class="txt">Invoice page</span> </a> </li>
                                    <li> <a href="profile.html"> <span class="icon"><i class="icon20 i-user"></i></span> <span class="txt">Profile page</span> </a> </li>
                                    <li> <a href="search.html"> <span class="icon"><i class="icon20 i-search-2"></i></span> <span class="txt">Search page</span> </a> </li>
                                    <li> <a href="email.html"> <span class="icon"><i class="icon20 i-envelop-2"></i></span> <span class="txt">Email page</span> </a> </li>
                                    <li> <a href="support.html"> <span class="icon"><i class="icon20 i-support"></i></span> <span class="txt">Support page</span> </a> </li>
                                    <li> <a href="faq.html"> <span class="icon"><i class="icon20 i-question"></i></span> <span class="txt">FAQ page</span> </a> </li>
                                    <li> <a href="blank.html"> <span class="icon"><i class="icon20 i-file-7"></i></span> <span class="txt">Blank page</span> </a> </li>
                                </ul>
                            </li>
                        </ul>
                    </nav>
                    <!-- End #mainnav --> 

                <!-- End .sidebar-wrapper --> 
            </aside>
            <!-- End #sidebar --> 
            <section id="content">
                <div class="wrapper">
         
                    <!--div class="crumb">
                        <ul class="breadcrumb">
                            <li><a href="#"><i class="icon16 i-home-4"></i>Home</a> <span class="divider">/</span></li>
                            <li><a href="#">Library</a> <span class="divider">/</span></li>
                            <li class="active">Data</li>
                        </ul>
                    </div-->
                    <div class="container-fluid">
                        <div id="heading" class="page-header">
                            <h1><i class="icon20 i-dashboard"></i> Dashboard</h1>
                        </div>
{{*******************}}
<!-- -->
<div class="js_content">
</div>
<!-- -->
                    </div>
                    <!-- End .container-fluid --> 
                </div>
                <!-- End .wrapper --> 
            </section>
        </div>
        <!-- End .main -->
</div>



<!----------TEMPLATE ----------->

<div style = "display:none" class="js_mailer_tpl" >
<table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered table-hover" id="dataTable">
    <thead>
        <tr>
            <th>id</th>
            <th>name</th>
            <th>mailer</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
            <tr><td>{{this.id }}</td><td>{{this.name}}</td><td>{{this.mailer}}</td><td><button type="button" class="del" rel-del="{{this.id }}" class="btn btn-primary">delete</button></td></tr>
    </tbody>
    <tfoot>
        <tr>
            <th>id</th>
            <th>name</th>
            <th>mailer</th>
            <th></th>
        </tr>
    </tfoot>
</table>

  <!-- Modal -->
  <div class="modal fade" id="ModalMailer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">Modal title</h4>
        </div>
        <div class="modal-body">
            <div class="control-group">
                <label class="control-label" for="name">Name</label>
                <div class="controls">
                  <input type="text" id="name" placeholder="name" value="">
                </div>       
            </div>
            <div class="control-group">
                <label class="control-label" for="template">template</label>
                <select  class="selectpicker show-tick" id="template_id" >
                   <option value = "{{ this.id }}">{{this.name}}</option>
                </select>     
            </div> 
            <div class="control-group">
                <label class="control-label" for="api">api</label>
                <select  class="selectpicker show-tick" id="api_id" >
                   <option value = "{{ this.id }}">{{this.name}}</option>
                </select>     
            </div>              
<div>
    <div>
        <div class="fl">Дата запуска:&nbsp;</div>
        <div id="delivery_start_datetimepicker" class="input-append date fl">
            <input id="timeout_value" name="SspAutoMail[start_date]" type="text" data-format="yyyy-MM-dd" style="height: 18px;">
            <span class="add-on" style="height: 18px;">
                <i data-time-icon="icon-time" data-date-icon="icon-calendar" class="icon-calendar"></i>
            </span>
        </div>
        <input id="hidden-start-date" type="hidden" value="2013-12-06">
        <div class="fl curent-time">Текущее время сервера: 2014-02-26 15:39</div>
    </div>
    <div class="cb"></div>
    <div class="fl">
        <span>Отправить письмо</span>
        <select id="schedule_type" name="SspAutoMail[schedule_type]">
            <option data-behaviour="immidiatly" value="0">Немедленно</option>
            <option data-behaviour="intime" selected="selected" value="1">Точно в</option>
            <option data-behaviour="later" value="2">С задержкой</option>
        </select>
    </div>
    <div id="additional" class="fl">
        <div id="intime" class="subCond">
            <select name="SspAutoMail[exactly_time]">
                <option value="0">0:00</option><option value="1">1:00</option><option value="2">2:00</option><option value="3">3:00</option><option value="4">4:00</option><option value="5">5:00</option><option value="6">6:00</option><option value="7">7:00</option><option value="8">8:00</option><option value="9">9:00</option><option value="10">10:00</option><option value="11">11:00</option><option value="12">12:00</option><option value="13">13:00</option><option value="14">14:00</option><option value="15">15:00</option><option selected="selected" value="16">16:00</option><option value="17">17:00</option><option value="18">18:00</option><option value="19">19:00</option><option value="20">20:00</option><option value="21">21:00</option><option value="22">22:00</option><option value="23">23:00</option>            </select>
        </div>
        <div class="subCond dn" id="later">
            <input name="SspAutoMail[delay_days]" value="0" type="text" style="width: 50px;"><span> дней </span>
            <input name="SspAutoMail[delay_hours]" value="0" type="text" style="width: 50px;"><span> часов</span>
        </div>


    </div>
    <div class="fl regular"><span> <input type="checkbox" name="SspAutoMail[regular_mark]" value="1"> Регулярно</span></div>
    <div style="clear:both"></div>
    <div id="days-list">
        <span>Дни отправки:&nbsp;
            <span><input type="checkbox" name="SspAutoMail[monday]" value="1">пн</span>
            <span><input type="checkbox" name="SspAutoMail[tuesday]" value="1">вт</span>
            <span><input type="checkbox" name="SspAutoMail[wednesday]" value="1">ср</span>
            <span><input type="checkbox" name="SspAutoMail[thursday]" value="1">чт</span>
            <span><input type="checkbox" name="SspAutoMail[friday]" checked="checked" value="1">пт</span>
            <span><input type="checkbox" name="SspAutoMail[saturday]" value="1">сб</span>
            <span><input type="checkbox" name="SspAutoMail[sunday]" value="1">вс</span>
        </span>
    </div>
</div>               
            <!--div class="control-group">
                <label class="control-label" for="api">API</label>
                <div class="controls">
                  <input type="text" id="api" placeholder="API" value="">
                </div>       
            </div-->  
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->     
<a data-toggle="modal" href="#ModalMailer"  class="btn btn-primary btn-lg">Add <i class="icon-plus"></i></a>
</div>
        
<!----------TEMPLATE ----------->       
<div style = "display:none" class="js_mail_api_tpl" >
<table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered table-hover" id="dataTable">
    <thead>
        <tr>
            <th>id</th>
            <th>name</th>
            <th>api</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
            <tr><td>{{ this.id }}</td><td>{{this.name}}</td><td>{{this.api}}</td><td><button type="button" class="del" rel-del="{{ this.id }}" class="btn btn-primary" on="click" action = "test">delete</button></td></tr>
    </tbody>
    <tfoot>
        <tr>
            <th>id</th>
            <th>name</th>
            <th>api</th>
            <th></th>
        </tr>
    </tfoot>
</table>
  <!-- Modal -->
  <div class="modal fade" id="ModalKeyAPI" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">Modal title</h4>
        </div>
        <div class="modal-body">
         <input type="hidden" id="id" placeholder="name" name="id" value="60">
            <div class="control-group">
                <label class="control-label" for="name">Name</label>
                <div class="controls">
                  <input type="text" id="name" placeholder="name" name="name" value="">
                </div>       
            </div>  
            <div class="control-group">
                <label class="control-label" for="api">API</label>
                <div class="controls">
                  <input type="text" id="api" placeholder="API" name="api" value="">
                </div>       
            </div>  
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" on="click" action = "saveAPI">Save changes</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->     
<a data-toggle="modal" href="#ModalKeyAPI"  class="btn btn-primary btn-lg">Add <i class="icon-plus"></i></a>
</div>        
<!----------TEMPLATE ----------->
<!----------TEMPLATE ----------->
<!----------TEMPLATE ----------->
<!----------TEMPLATE ----------->
<div style = "display:none" class="js_login_tpl">
<div class="container-fluid">
  <div id="login">
    <div class="login-wrapper" data-active="log">
      <div id="log">
        <div class="page-header">
          <h3 class="center">Please login</h3>
        </div>
        <form id="login-form" class="form-horizontal" _action="dashboard.html">
          <div class="row-fluid">
            <div class="control-group">
              <div class="controls-row">
                <div class="icon"><i class="icon20 i-user"></i></div>
                <input class="span12" type="text" name="email" id="user" placeholder="E-mail" value="suggeelson@suggeelson.com">
              </div>
            </div>
            <!-- End .control-group -->
            <div class="control-group">
              <div class="controls-row">
                <div class="icon"><i class="icon20 i-key"></i></div>
                <input class="span12" type="password" name="password" id="password" placeholder="Password" value="somepassword">
              </div>
            </div>
            <!-- End .control-group -->
            <div class="form-actions full">
              <label class="checkbox pull-left">
                <input type="checkbox" value="1" name="remember">
                <span class="pad-left5">Remember me ?</span> </label>
              <button id="loginBtn" type="submit" class="btn btn-primary pull-right span5">Login</button>
            </div>
          </div>
          <!-- End .row-fluid -->
        </form>
        <p class="center">Don`t have an account? <a href="#" id="register"><strong>Create one now</strong></a></p>
        <div class="or center"><strong>or</strong></div>
        <hr class="seperator">
        <a href="#" class="btn btn-primary pull-left"><i class="icon16 i-facebook gap-left0"></i> Connect</a> <a href="#" class="btn btn-info pull-right"><i class="icon16 i-twitter gap-left0"></i> Connect</a> </div>
      <div id="reg">
        <div class="page-header">
          <h3 class="center">Register account</h3>
        </div>
        <form class="form-horizontal"  id="reg-form">
          <div class="row-fluid">
            <div class="control-group">
              <div class="controls-row">
                <div class="icon"><i class="icon20 i-user"></i></div>
                <input class="span12" type="text" name="user" id="user" placeholder="Username">
              </div>
            </div>
            <!-- End .control-group -->
            <div class="control-group">
              <div class="controls-row">
                <div class="icon"><i class="icon20 i-key"></i></div>
                <input class="span12" type="password" name="password" id="password" placeholder="Password">
              </div>
            </div>
            <!-- End .control-group -->
            <div class="control-group">
              <div class="controls-row">
                <div class="icon"><i class="icon20 i-key"></i></div>
                <input class="span12" type="password" name="password1" id="password_again" placeholder="Re-type password">
              </div>
            </div>
            <!-- End .control-group -->
            <div class="control-group">
              <div class="controls-row">
                <div class="icon"><i class="icon20 i-envelop-2"></i></div>
                <input class="span12" type="text" name="email" id="email-field" placeholder="Your email">
              </div>
            </div>
            <!-- End .control-group -->
            <div class="form-actions full">
              <button type="button" class="btn btn-large btn-block btn-danger" id="js_reg">Register my account</button>
            </div>
          </div>
          <!-- End .row-fluid -->
        </form>
      </div>
      <div id="forgot">
        <div class="page-header">
          <h3 class="center">Forgot password</h3>
        </div>
        <form class="form-horizontal">
          <div class="row-fluid">
            <div class="control-group">
              <div class="controls-row">
                <div class="icon"><i class="icon20 i-user"></i></div>
                <input class="span12" type="text" name="user" id="user" placeholder="Username">
              </div>
            </div>
            <!-- End .control-group -->
            <div class="control-group">
              <div class="controls-row">
                <div class="icon"><i class="icon20 i-envelop-2"></i></div>
                <input class="span12" type="text" name="email" id="email-field" placeholder="Your email">
              </div>
            </div>
            <!-- End .control-group -->
            <div class="form-actions full">
              <button type="submit" class="btn btn-large btn-block btn-success">Recover my password</button>
            </div>
          </div>
          <!-- End .row-fluid -->
        </form>
      </div>
    </div>
    <div id="bar" data-active="log">
      <div class="btn-group btn-group-vertical"> 
          <a id="log" href="#/login/" class="btn tipR" title="Login"><i class="icon16 i-key"></i></a> 
          <a id="reg" href="#/login/" class="btn tipR" title="Register account"><i class="icon16 i-user-plus"></i></a> 
          <a id="forgot" href="#/login/" class="btn tipR" title="Forgout password"><i class="icon16 i-question"></i></a> 
      </div>
    </div>
    <div class="clearfix"></div>
  </div>
</div>
</div>
<!----------TEMPLATE ----------->
<!----------TEMPLATE ----------->

<div style = "display:none" class="js_statistics_tpl">  

<div id="chart-2" style="height: 300px;"></div>

<div class="well">
  <div id="datestart" class="input-append date">
    <input data-format="dd/MM/yyyy hh:mm:ss" type="text"></input>
    <span class="add-on">
      <i data-time-icon="icon-time" data-date-icon="icon-calendar">
      </i>
    </span>
  </div>
  <div id="dateend" class="input-append date">
    <input data-format="dd/MM/yyyy hh:mm:ss" type="text"></input>
    <span class="add-on">
      <i data-time-icon="icon-time" data-date-icon="icon-calendar">
      </i>
    </span>
  </div>  
</div>
<script type="text/javascript">
  $(function() {
    //$('#datestart').datetimepicker({ });
   // $('#dateend').datetimepicker({ });
  });
</script>
    <script type="text/javascript">
       $(function () {
            $('#datestart').datetimepicker();
            $('#dateend').datetimepicker();
            $("#datestart").on("dp.change",function (e) {
               $('#dateend').data("DateTimePicker").setMinDate(e.date);
            });
            $("#datestart").on("dp.change",function (e) {
               $('#dateend').data("DateTimePicker").setMaxDate(e.date);
            });
        });
        
    </script>

<div id="tabs">
  <ul>
    <li><a href="#tabs-1">Merge</a></li>
    <li><a href="#tabs-2">ApiStat</a></li>
    <li><a href="#tabs-3">CntStat</a></li>
  </ul>
  <div id="tabs-1">
<div id="statlistmerge" style=" overflow: auto; ">
    <input type="text" class="search" placeholder="Search contact" />
<table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered table-hover" id="tbl_merge">
    <thead>
        <tr>      
            <th>	клики	</th>
            <th>	Начислено_руб	</th>
            <th>	status	</th>             
            <th>	partner_id	</th>
            <th>	host	</th>            
            <th>	query	</th>
            <th>	client_ip	</th>
            <th>	subaccount	</th> 
            <th>	unique_id	</th>             
            <th>	current_page	</th>
            <th>	created_at	</th>
            <th>	date	</th>
        </tr>
    </thead>
    <tbody class="list">

            <tr>
                <td class="clicks">{{this.clicks}}</td>
                <td class="payment">{{this.payment}}</td>
                <td class="status">{{this.status}}</td>
                <td class="partner_id">{{this.partner_id}}</td>   
                <td class="host">{{this.host}}</td>
                <td class="query">{{this.query}}</td>
                <td class="client_ip">{{this.client_ip}}</td>
                <td class="subaccount">{{ this.subaccount }}</td>
                <td class="unique_id">{{this.unique_id}}</td>
                <td class="current_page">{{this.current_page}}</td>
                <td class="created_at">{{this.created_at}}</td>
                <td class="date">{{this.date}}</td>          
            </tr>

    </tbody>
    <tfoot>
        <tr>
            <th>	клики	</th>
            <th>	Начислено_руб	</th>
            <th>	status	</th>             
            <th>	partner_id	</th>
            <th>	host	</th>            
            <th>	query	</th>
            <th>	client_ip	</th>
            <th>	subaccount	</th> 
            <th>	unique_id	</th>             
            <th>	current_page	</th>
            <th>	created_at	</th>
            <th>	date	</th>
        </tr>
    </tfoot>
</table>
<ul class="pagination"></ul>
</div> 
  </div>
  <div id="tabs-2">
<div id="statlistapi"  style=" overflow: auto; ">
    <input type="text" class="search" placeholder="Search contact" />
<table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered table-hover" id="tbl_api">
    <thead>
        <tr>
            <th>id</th>
             <th>	subaccount	</th>            
             <th>	клики	</th>
             <th>	Начислено_руб	</th>
             <th>	status	</th>             
             <th>	partner_id	</th>
             <th>	date	</th>
        </tr>
    </thead>
    <tbody class="list">

            <tr>
            <td class="_id">{{ this._id }}</td>
            <td class="subaccount">{{ this.subaccount }}</td>
            <td class="clicks">{{this.clicks}}</td>
            <td class="payment">{{this.payment}}</td>
            <td class="status">{{this.status}}</td>
            <td class="partner_id">{{this.partner_id}}</td>
            <td class="date">{{this.date}}</td>
            </tr>

    </tbody>
    <tfoot>
        <tr>
            <th>id</th>
             <th>	subaccount	</th>            
             <th>	клики	</th>
             <th>	Начислено_руб	</th>
             <th>	status	</th>             
             <th>	partner_id	</th>
             <th>	date	</th>
        </tr>
    </tfoot>
</table>
<ul class="pagination"></ul>
</div>   
    <div class="form-actions">
      <button type="button" id="update" class="btn btn-primary" on="click" action="updateStat">UPDATE</button>
    </div>
  </div>
  <div id="tabs-3">
<div id="statlist" style=" overflow: auto;" >
    <input type="text" class="search" placeholder="Search contact" />

    <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered table-hover" id="tbl_counter">
        <thead>
            <tr>
                <th>id</th>
                 <th>	host	</th>            
                 <th>	query	</th>
                 <th>	client_ip	</th>
                 <th>	unique_id	</th>             
                 <th>	current_page	</th>
                 <th>	created_at	</th>
                 <th>	date	</th>
            </tr>
        </thead>
        <tbody class="list">    
           <tr>
               <td class="_id">{{this._id}}</td>
               <td class="host">{{this.host}}</td>
               <td class="query">{{this.query}}</td>
               <td class="client_ip">{{this.client_ip}}</td>
               <td class="unique_id">{{this.unique_id}}</td>
               <td class="current_page">{{this.current_page}}</td>
               <td class="created_at">{{this.created_at}}</td>
               <td class="date">{{this.date}}</td>
           </tr>
        </tbody>
    </table>
    <ul class="pagination"></ul>
</div>
  </div>
</div>


    
<hr>

</div>

<!----------TEMPLATE ----------->
<!----------TEMPLATE ----------->

<div style = "display:none" class="js_screenshot_tpl">
<div id="FormScreenShot">
    <div class="control-group">
        <label class="control-label" for="name">Site</label>
        <div class="controls">
          <input type="text" id="site" placeholder="Site" name="site" value="astrolog2u.ru,promocode2u.ru">
        </div>       
    </div>  
    <div class="control-group">
        <label class="control-label" for="api">Size</label>
        <div class="controls">
          <input type="text" id="size" placeholder="Size" name="size" value="1024x768,1366x768,1600x900">
        </div>       
    </div>
    <div class="form-actions">
      <button type="button" id="js_screenshot_btn" class="btn btn-primary" on="click" action = "screenshot">SCREENSHOT</button>
    </div>            
</div>
</div>
<!----------TEMPLATE ----------->
<!----------TEMPLATE ----------->

<div style = "display:none" class="js_partners_tpl">
<table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered table-hover" id="tbl_partners">
    <thead>
        <tr>
            <th>id</th>
            <th>name</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
            <tr><td>{{ this._id }}</td><td>{{this.name}}</td><td><button type="button" class="del" rel-del="{{ this._id }}" class="btn btn-primary">delete</button></td></tr>
    </tbody>
    <tfoot>
        <tr>
            <th>id</th>
            <th>name</th>
            <th></th>
        </tr>
    </tfoot>
</table>


    <div class="control-group">
        <label class="control-label" for="partner_name">Name Partner</label>
        <div class="controls">
          <input type="text" id="partner_name" placeholder="partner_name" value="">
        </div>       
    </div>
        
    <div class="form-actions">
      <button type="button" id="create" class="btn btn-primary">Create</button>
    </div>
</div>

<div id="example2">CCC</div>
<!----------TEMPLATE ----------->

<!----------TEMPLATE ----------->
<!----------TEMPLATE ----------->
<!----------TEMPLATE ----------->
<!----------TEMPLATE ----------->
<style>
#selname, #selxpath{
background-color:rgb(253, 0, 0) !important;
}


.xml                { font-family: "Courier New"; color: #000; font-size: 10pt; }
.xml .rem           { color: #A0A0A0; }
.xml .cdatao, .xml .cdatac
                    { color: #A0A0A0; }
.xml .cdata         { color: #000; }
.xml .tag           { color: #0000FF; }
.xml .name          { color: #AA1515; font-weight: bold; }
.xml .attr          { color: #AA1515; }
.xml .attr .name    { color: #FF0000; font-weight: normal; }
.xml .attr .value   { color: #0000FF; }

.js                 { font-family: "Courier New"; color: #000; font-size: 10pt; }
.js .rem            { color: #A0A0A0; }
.js .str            { color: #AA1515; }
.js .re             { color: #FF0000; }
.js .kw             { color: #0000FF; font-weight: bold; }
.js .func           { color: #0000FF; }
.js .gly            { font-weight: bold; }

.cs                 { font-family: "Courier New"; color: #000; font-size: 10pt; }
.cs .rem            { color: #A0A0A0; }
.cs .str            { color: #AA1515; }
.cs .re             { color: #FF0000; }
.cs .kw             { color: #0000FF; font-weight: bold; }
.cs .func           { color: #0000FF; }
.cs .gly            { font-weight: bold; }

.css                { font-family: "Courier New"; color: #000; font-size: 10pt; }
.css .rem           { color: #A0A0A0; }
.css .sel           { color: #AA1515; }
.css .name          { color: #FF0000; font-weight: normal; }
.css .value         { color: #0000FF; }
</style>
<style>
.layer {
    overflow: scroll; /* Добавляем полосы прокрутки */
    width: 900px; /* Ширина блока */
    height: 500px; /* Высота блока */
    padding: 5px; /* Поля вокруг текста */
    border: solid 1px black; /* Параметры рамки */
} 
</style>
<style>
.extracted-items-container {
pointer-events: none;
background-color: rgba(0,0,0,0.8);
padding: 10px;
width: 400px;
box-shadow: 0px 0px 12px 0px rgba(0,0,0,1.0);
position: fixed;
left: 400px;
top: 30px;
}

#hovered-element-info {
font: 1.0em Helvetica,Arial,sans-serif;
color: white;
padding: 8px;
/*float: left;*/
background-color: rgba(0,0,0,0.8);
box-shadow: 0px 4px 6px 0px rgba(0,0,0,0.8);
margin-right: 15px;
/*display: none;*/
pointer-events: all;
/*max-width: 450px;*/
border-radius: 3px;
}
</style>
<!----------TEMPLATE ----------->
    </body>
   

    
    <script>
function updateStat(){
    $.post(server+'/updatestat/', {}, function(data){
        console.log(data);
        
    }); 
}    
    
    
function test(){

var event = event || window.event
var t = event.target || event.srcElement

console.log(t.getAttribute('rel-del'));

}





function saveAPI(){
    var form = document.querySelector('#ModalKeyAPI');
    var formData = form2obj(form);
    var tr = document.querySelector('.js_content tbody tr');
    formData['id'] = Math.floor((Math.random()*10)+1);
    formData['elm'] = '<button type="button" class="del" rel-del="'+formData.id+'" class="btn btn-primary" on="click" action = "test">delete</button>';
    var row = createRow(formData);
    var table = document.querySelector('.js_content tbody');
    table.appendChild(row);
    var btn = document.querySelectorAll('button');
    setEvent(btn);
}

function screenshot(){
    var form = document.querySelector('#FormScreenShot');
    var formData = form2obj(form);
    //console.log($.param(formData));
    $.get(server+'/screenshot/', formData, function(data){
        console.log(data);
        
    });      
}
/* 
    Router.map("*", function() {    
        $.post(server+'/is-auth/', { }, function(data){
            if(!data.isAuth){
                Router.redirect('login');
            }
        }); 
    });
*
*
    Router.map("dashboard", function() {
        $('.js_login_tpl').css('display','none');
        $('#js_main_tpl').css('display','block');
        $('#heading > h1').text('dashboard');
        var dashboard_tpl = $('.js_dashboard_tpl').html();
        $('.js_content').html(dashboard_tpl);
        $.post(server+'/get-dashboard/', { }, function(data){
            console.log(data);
            var arr = [];
            var actionpay = data['actionpay'].dashboard.wallets[0];
            var admitad = data['admitad'].dashboard[0];
            arr.push({partner:'actionpay',click:null,paid:actionpay.available,hold:actionpay.hold,balance:actionpay.balance});
            arr.push({partner:'admitad',click:admitad.clicks,paid:admitad.paid,hold:admitad.hold,balance:admitad.balance});
            var rep = new _repeatable('.js_content tbody')
            rep.value = arr;
      
        });        
    });
* 
    Router.map("/login/", function() {    
        $('#js_main_tpl').css('display','none');
        $('.js_login_tpl').css('display','block');
    });
*/    
    
    Router.map("/partners/", function() {    
        $('#heading > h1').text('Partners');
        var partners_tpl = $('.js_partners_tpl').html();
        $('.js_content').html(partners_tpl);
        $.get(server+'/partners/', { }, function(data){
            var rep_partners = new _repeatable('.js_content #tbl_partners tbody');
            rep_partners.value = data;
        });
        
    });
    Router.map("/users/", function() {    
        $('#heading > h1').text('Users');
        var users_tpl = $('.js_users_tpl').html();
        $('.js_content').html(users_tpl);
        $.get(server+'/users/', { }, function(data){
            var rep_users = new _repeatable('.js_content #tbl_users tbody');
            rep_users.value = data;
        });
        
    });
    

/*************************************/
var parser = {};
parser.controller = function(ctrl) {
    this.groupvk = function(){
        var url = $('#inputURL').val();
        var offset = $('#offset').val();
        var owner_id = $('#owner_id').val();
        
        m.request({method: "GET", url: server+'/group-vk/'}).then(function(data) {console.log(data);});
       /* $.post(server+'/group-vk/',{'url':url, 'offset':offset, 'owner_id':owner_id},function(data){
            console.log(data);
        }); */   
    } 
};

parser.view = function(ctrl) {
    return m.render(document.querySelector('div.js_content'),  m(".js_parse_groupvk_tpl", [
        m("form.form-horizontal",[        
            m("table", [
                m("tr", [
                    m("td", "URL"),
                    m("td", [ m("input",{value:"http://vk.com/wildberries_yes"})]),
                ]),
                m("tr", [
                    m("td", "offset"),
                    m("td", [ m("input",{value:""})]),
                ]),
                m("tr", [
                    m("td", "owner_id"),
                    m("td", [ m("input",{value:"-41925913"})]),
                ]),                                
            ])        
        ]),
        m("button", {onclick: ctrl.groupvk.bind(ctrl)}, "Add"),
    ]));
};

//m.module(document.querySelector('div.js_content'), parser);

var paesehtml = {};
paesehtml.controller = function() {
    var cnt = 0;
    var scnt = 0;
       
    function createObject(el) {
	    //var id = 'swf';
	           cnt++;
	    var id = 'div#row'+cnt+'.dfg';
        var _xpath = 'Xpath_'+cnt;
        var _name = 'Name_'+cnt;
        var _type = 'Type_'+cnt;
	    var div =   v(id, {}, [ 
	            v('select.form-control.type.selattr',{name:_type},[
                      v("option", {value:''}, ''),
                      v("option", {value:'link'}, 'link'),
                      v("option", {value:'text'}, 'text'),
                      v("option", {value:'html'}, 'html'),
                      v("option", {value:'img'}, 'img'),
                      v("option", {value:'table'}, 'table'),
	            ]),
	            v('input.form-control.name',{type:'text',placeholder:'Name',name:_name}),
	            v('input.form-control.xpath',{type:'text',placeholder:'Xpath',name:_xpath}),
	            v("button.btn.btn-default#add_sub_item", { onclick: addItem}, "Add SubItem"),
	            v('button.btn.del',{type:'button'},'&times;'),
	    ]);
	    el.appendChild(div);
	    return 
    };
    function createSubItem() {

        scnt++;
	    var id = 'div#sub'+scnt+'';
        var _xpath = 'xpath';
        var _name = 'name';
        var _type = 'type';
	    return v(id, {}, [ 
	            v('select.form-control.type.selattr',{name:_type},[
                      v("option", {value:''}, ''),
                      v("option", {value:'link'}, 'link'),
                      v("option", {value:'text'}, 'text'),
                      v("option", {value:'html'}, 'html'),
                      v("option", {value:'img'}, 'img'),
                       v("option", {value:'table'}, 'table'),
	            ]),
	            v('input.form-control.name',{type:'text',placeholder:'Name',name:_name}),
	            v('input.form-control.xpath',{type:'text',placeholder:'Xpath',name:_xpath}),
	            v("button.btn.btn-default#add_sub_item", { onclick: addSubItem, 'data-id':id}, "Add SubItem"),
	            v('button.btn.del',{type:'button'},'&times;'),
	    ]);
    };    

    addSubItem = function(e){
        //e = e || event;
        //var target = e.target || e.srcElement;
        //var d_id = '#'+$(target).parent().attr('id');
if(tree){
        //var tree = new VanillaTree( d_id, {});
        cnt++;
        console.log(tree.getSelected());
        tree.add({
          el: createSubItem(),
          id: 'af'+cnt,
          label:'aa'+cnt,
          parent :_selID,
          opened: true
        }); 
  }         
    };
    var tree = undefined;
    var _selID = undefined;
    addItem = function(e){
        //var d_id  = '#rows';
        //var tree = new VanillaTree( d_id, {});
        if(!tree){
            tree = new VanillaTree( '#rows', {});
            document.querySelector('#rows').addEventListener('vtree-select', function(evt) {
                _selID = evt.detail.id
            });            
        }
        tree.add({
          el: createSubItem(),
          id: 'a'+scnt,
          opened: true
        });    
    };
    this.add = function(){
	    addItem(); 
    };
    this.seltype = [
        '',
        'link',
        'text',
        'html',
        'img',
        'table',
    ];
    this.parse = function(){
        _parse();
    };
    
    this.parsepreview = function(){
       var url = $('#inputURL').val(); 
	   //$('#text_preview').val(data.body);
	   var type = $('#type').val();
	   if(type === 'xml')
	   {
		   $('#HTMLview').hide();
		   $('#preview-html').hide();
		   $('pre.xml').css('display','block');
		   $('pre.xml').text(data.body);
		   $('pre.xml').DmSyntaxXML();
		   return false;
	   }else if(type === 'html'){
			PARSE.parse_html(url);

	   }
       return false;
    };
	
	this.setDelStyle = function(){
		if(PARSE.DelStyle){
			PARSE.DelStyle = false;
		}else{
			PARSE.DelStyle = true;
		}
	};
	this.setBaseTag = function(){
		if(PARSE.BaseTag){
			PARSE.BaseTag = false;
		}else{
			PARSE.BaseTag = true;
		}
	};	
	
};
paesehtml.view = function(ctrl) {
    $('#heading > h1').text('parser');
    $('#js_main_tpl').css('display','block');
    $('#js_cpalab_title_tpl').css('display','none');
    $('.js_login_tpl').css('display','none'); 
    return m.render(document.querySelector('div.js_content'), m(".js_parse_html_xml_tpl", [
        m(".form-horizontal",[        
            m("table", [
                m("tr", [
                    m("td", "Name"),
                    m("td", [ m("input#name",{placeholder:"Name",value:""})]),
                ]),
                m("tr", [
                    m("td", "TYPE"),
                    m("td", [ m("select.form-control#type",[
                        m("option","html"),
                        m("option","xml")
                    ])]),
                ]),
                m("tr", [
                    m("td", "URL"),
                    m("td", [ m("input#inputURL",{placeholder:"URL",value:"http://toomuchdata.com/"})]),
                ]),  
                m("tr", [
                    m("td", "del style"),
                    m("td", [ m("input#del_style",{type:"checkbox", onclick:ctrl.setDelStyle.bind(ctrl)})]),
                ]),
                m("tr", [
                    m("td", "add base tag"),
                    m("td", [ m("input#add_base_tag",{type:"checkbox", onclick:ctrl.setBaseTag.bind(ctrl)})]),
                ]),  				
            ]),
            m("button#previewparsehtml",{  onclick: ctrl.parsepreview.bind(ctrl) },"Показать"),
            m(".form-actions",[
                m('button.btn.btn-primary#save',{},'Сохранить'),
                m('button.btn.btn-primary#parse',{ onclick: ctrl.parse.bind(ctrl)},'Parse'),
                m('button.btn',{},'Отменить'),
            ])                   
        ]),
        m('pre.xml.layer',{style:{display:'none'}}),
        m('div#preview-html',{style:{display:'none'}},[
            m('#hovered-element',{style:{position:'absolute'}},[m("#hovered-element-info")]),
            m('div',[
                m("iframe#HTMLview.layer",{style:{display:'none'}})
            ]),
        ]),
        m("button.btn.btn-default#add", { onclick: ctrl.add.bind(ctrl)}, "Add Item"),
        m('br'),        
        m("#rows" ,{})
    ]));
};
/***********************************************/
var parserules = {};
parserules.rules = function() { return m.request({method : "GET",url:'/parse-rules/'});};
parserules.controller = function() {
    this.rule_list = parserules.rules();
    /*function(){
        $.get(server+'/parse-rules/', { }, function(data){
        console.log(data);
        });
    } */
    this.parse = function(){
        var rule = document.querySelector('#rule_id').value;
    	$.post( server+"/parse-run/", {rule:rule}, function( data ) {
            console.log(data);
        });
    }
};
parserules.view = function(ctrl) {
    $('#heading > h1').text('parser rule');
    $('#js_main_tpl').css('display','block');
    $('#js_cpalab_title_tpl').css('display','none');
    $('.js_login_tpl').css('display','none'); 

    return m.render(document.querySelector('div.js_content'), m(".js_parse_rules_tpl", [
            m("select#rule_id",{name:"rule"},[
                ctrl.rule_list().map(function(data, index) {
                    return m("option", {value:data},data);
                })                               
            ]),
            m('button.btn.btn-primary#parse',{ onclick: ctrl.parse.bind(ctrl)},'Parse'),    
    ]));


}
/**********************************************/
var dashboard = {};

//model
dashboard.List = function() {
	return m.request({method: "POST", url: server+'/get-dashboard/'}).then(function(data) {
	    var arr = [];
        if(data.isAuth === false){
           return m.route("/login/");
        }
	    if(data.res != 'empty'){
            var actionpay = data['actionpay'].dashboard.wallets[0];
            var admitad = data['admitad'].dashboard[0];
            if(actionpay)
                arr.push({partner:'actionpay',click:null,paid:actionpay.available,hold:actionpay.hold,balance:actionpay.balance});
            if(admitad)
                arr.push({partner:'admitad',click:admitad.clicks,paid:admitad.paid,hold:admitad.hold,balance:admitad.balance});	   
        } 
        return arr;
    });
};
dashboard.controller = function() {
    this.list = dashboard.List();
};

dashboard.view = function(ctrl) {
    $('#heading > h1').text('dashboard');
    $('#js_main_tpl').css('display','block');
    $('#js_cpalab_title_tpl').css('display','none');
    $('.js_login_tpl').css('display','none');    
    return m.render(document.querySelector('div.js_content'),  m(".js_dashboard_tpl", [    
        m("table.table.table-striped.table-bordered.table-hover#dataTable", [
            m("thead",[
                m("tr", [
                    m("th", "partner"),
                    m("th", "переходов"),
                    m("th", "доступно"),
                    m("th", "в обработке"),
                    m("th", "заработано"),
                ])
            ]),
            m("tbody",[
                ctrl.list().map(function(data, index) {
                    return m("tr", [
                        m("td", data.partner),
                        m("td", data.click),
                        m("td", data.paid),
                        m("td", data.hold),
                        m("td", data.balance),
                    ])
                })
           ]),
            m("tfoot",[
                m("tr", [
                    m("th", "partner"),
                    m("th", "переходов"),
                    m("th", "доступно"),
                    m("th", "в обработке"),
                    m("th", "заработано"),
                ])
            ])                       
        ])
    ]));
};

/**********************************************/
var screenshot = {};


screenshot.listlink = function(){

      
};

screenshot.controller = function(){
    var self = this;
    this.arrlistlink = [];
    var serialize = function(obj) {
      var str = [];
      for(var p in obj)
        if (obj.hasOwnProperty(p)) {
          str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
        }
      return str.join("&");
    };    
    this.screen = function(){
        var form = document.querySelector('#FormScreenShot');
        var formData = form2obj(form);
        this.arrlistlink = m.request({method : "GET",url:'/screenshot/', data:formData }).then(function(data) {
            self.arrlistlink  = data;
            //console.log(this.arrlistlink);
            //return this.arrlistlink ;
            /*m.render(document.querySelector('div.js_content'),m("ul",[
                data.map(function(data, index) {
                    return m("li",  data.partner);
                })
            ]));*/        
        });
    };
};
screenshot.view = function(ctrl) {
    //console.log(ctrl);
    $('#heading > h1').text('screenshot');
    $('#js_main_tpl').css('display','block');
    $('#js_cpalab_title_tpl').css('display','none');
    $('.js_login_tpl').css('display','none');        
    return m.render(document.querySelector('div.js_content'),  m(".js_screenshot_tpl", [
        m("#FormScreenShot",[        
            m("table", [
                m("tr", [
                    m("td", "Site"),
                    m("td#site", [ m("input#size",{value:"astrolog2u.ru,promocode2u.ru", name:"site"})]),
                ]),
                m("tr", [
                    m("td", "Size"),
                    m("td", [ m("input#size",{value:"1024x768,1366x768,1600x900", name:"size"})]),
                ]),                            
            ]),        
        ]),
        m("button.btn.btn-primary#js_screenshot_btn", {onclick: ctrl.screen.bind(ctrl)}, "Add"),
        
        m("ul",[
                ctrl.arrlistlink.map(function(data, index) {
                    return m("li", [ m( "a",{href:data}, data)]);
                })        
        ])

    ]));
};
/**********************************************/
var login = {};
login.controller = function(){};
login.view = function(ctrl){
        $('#js_cpalab_title_tpl').css('display','none');
        $('#js_main_tpl').css('display','none');
        $('.js_login_tpl').css('display','block');
	    $('#loginBtn').on('click',function(){
	        var form = document.querySelector('#login-form');
	        var formData = form2obj(form);
        	$.post( server+"/api-login/", formData, function( data ) {
                if(data.user ){
                    //Router.redirect('dashboard');
                    m.route("/dashboard/");
                }
            });
	    });        
};
/**********************************************/
var logout = {};
logout.controller = function(){};
logout.view = function(ctrl){
    $.post(server+'/logout/', { }, function(data){
        if(!data.isAuth){
            m.route("/login/");
        }
    });        
};


/***********************************************/
var mailer = {};

mailer.getPreviewTpl = function(){

};

mailer.controller = function(){
    this.tpl = mailer_template.tpls();
    this.sendmail = function(){
        var form = document.querySelector('#send');
        var formData = form2obj(form);
        $.post('/send-mail/',formData, function(data){
            console.log(data);
            alert(JSON.stringify(data));
        });
        
    };
    var createWindow = function(win){
        if(!win.error){
            if(preview != undefined){
                preview.close();
            }              
            var preview = window.open('', 'preview', win.settings);        
            preview.document.write(win.text);
            preview.focus();
        }else{
            alert(win.error);
        }
    };
     
    this.preview = function(){
        var form = document.querySelector('#send');
        var formData = form2obj(form);
        formData['settings'] = 'scrollbars=yes,width=800,height=500'
        $.post('/preview/',formData, createWindow);        
    };
};
mailer.view = function(ctrl){
    $('#heading > h1').text('Рассылки');
    $('#js_main_tpl').css('display','block');
    $('#js_cpalab_title_tpl').css('display','none');
    $('.js_login_tpl').css('display','none');        
    var sendmailtpl = m(".js_sendmail_tpl", [
        m( "#send",[
            m("select#tpl",{name:"tpl"},[
                ctrl.tpl().map(function(data, index) {
                    return m("option", {value:data._id}, data.name);
                })                               
            ]),
            m("br"),    
            m("button.btn.btn-primary#js_sendmail_btn", {onclick: ctrl.sendmail.bind(ctrl)}, "SendMail"),
            m("button.btn.btn-primary#js_view_mail_btn", {onclick: ctrl.preview.bind(ctrl)}, "preview"),
        ])
    ]);    
    return m.render(document.querySelector('div.js_content'), sendmailtpl);   
    $('.js_content').html($('.js_mailer_tpl').html());      
};
/***********************************************/
var mailer_banner = {};

mailer_banner.list = function() { 
var banner = m.request({method : "GET",url:'/mailer-banner/'});
return banner;
};
mailer_banner.getBanner = function(id){
    mailer_banner.list().then(function( _banner){
        var count =  _banner.length;
        for(var i=0; i < count; i++){
            if(_banner[i]._id === id){
                console.log(_banner[i]);
                $("input#url").val(_banner[i].url);
                $("input#resources").val(_banner[i].img);
                $("select#days").val(_banner[i].days);
                $("select#tpl_id").val(_banner[i].tpl_id._id);
                $("input#active").attr('cheked',_banner[i].active);          
                return _banner[i];
            }
        }
          
    });

}
mailer_banner.controller = function(){
    var self = this;
    this.tpl = mailer_template.tpls();//[{name:"test",val:"t"},{name:"test1",val:"t1"}];
    this.banners = mailer_banner.list();
    this.list= []; 
    /*this.add_mailer_tpl = function(){
        var form = document.querySelector('#FormMailerTpl');
        var formData = form2obj(form);
        this.arrlistlink = m.request({method : "GET",url:'/add-mailer-tpl/', data:formData }).then(function(data) {
            self.list  = data;
            //console.log(data);      
        });
    };*/
    this.mailer_banner_add = function(){
        document.querySelector('#ModalAddBanner .modal-title').textContent = 'Add banner';
        var form = document.querySelector('#ModalAddBanner');
        var formData = form2obj(form);
        /*
        m.request({method : "POST",url:'/mailer-banner-add/', data:formData }).then(function(data) {
            console.log(data); 
            alert(JSON.stringify(data));  
        });
        */
        $.post( "/mailer-banner-add/", formData, function( data ) {
          console.log(data);
        });
        /*
        $.ajax({
            type: "POST",
            url: "/mailer-banner-add/",
            enctype: 'multipart/form-data',
            data:formData,
            success: function () {
                alert("Data Uploaded: ");
            }
        }); 
         //*/            
    };
    this.mailer_banner_del = function(e){
        var id = e.target.id;
        $.post( "/mailer-banner-del/", {banner_id :id}, function( data ) {
          console.log(data);
          alert(JSON.stringify(data));
        });  

    };    
    this.mailer_banner_edit = function(e){

        var form = document.querySelector('#ModalAddBanner');
        var formData = form2obj(form);
        /*m.request({method : "POST",url:'/mailer-banner-edit/', data:formData }).then(function(data) {
            console.log(data); 
            alert(JSON.stringify(data));  
        });*/
        
        $.post( "/mailer-banner-edit/", formData, function( data ) {
          console.log(data);
          alert(JSON.stringify(data));  
        })        
        
         
        //mailer_banner.getBanner(id);
    };
    this.set_banner_id = function(e){
        var banner_id = e.target.id;
        document.querySelector('#banner_id').value = banner_id;
        mailer_banner.getBanner(banner_id);
        $('#js_edit_banner_btn').css('display','block');
        $('#js_add_banner_btn').css('display','none');
    }
};
mailer_banner.view = function(ctrl){
    $('#heading > h1').text('Рекламные блоки');
    var days = [
    {title: "Пон",val:"1"},
    {title: "Вт",val:"2"},
    {title: "Ср",val:"3"},
    {title: "Чет",val:"4"},
    {title: "Пят",val:"5"},
    {title: "Суб",val:"6"},
    {title: "Вос",val:"0"},
    ];  

    
    var modal_add_banner_tpl = function(){
        return  m(".modal.fade#ModalAddBanner",{'tabindex':"-1",'role':"dialog",'aria-labelledby':"myModalLabel", 'aria-hidden':"true"},[
            m(".modal-dialog",[
                m(".modal-content",[
                    m(".modal-header",[
                        m(".close",{'data-dismiss':"modal", 'aria-hidden':"true"},"&times;"),
                        m(".modal-title",{},"Add banner"),
                    ]),
                    m(".modal-body",[
                        m("input#banner_id",{name:"banner_id",type:'hidden'}),
                        m("input#url",{name:"url",placeholder:"URL",value:""}),
                        m("br"),
                        //m("input#img",{name:"file",type:"file"}),
                        m("br"),
                        m("input#resources",{name:"resources",placeholder:"resources",type:"text"}),
                        
                        m("br"),
                        m("select#days",{name:"days"},[
                            days.map(function(data, index) {
                                return m("option", {value:data.val},data.title);
                            })                               
                        ]),
                        m("br"),
                        m("select#tpl_id",{name:"tpl_id"},[
                            ctrl.tpl().map(function(data, index) {
                                return m("option", {value:data._id},data.name);
                            })                               
                        ]),
                        m("br"),
                        m("input#active",{name:'active', type:"checkbox"})
                    ]),
                    m(".modal-footer",[
                        m("button.btn.btn-default",{'type':"button", 'data-dismiss':"modal"},"Close"),
                        m("button.btn.btn-primary#js_add_banner_btn",{'type':"button",onclick: ctrl.mailer_banner_add.bind(ctrl)},"Add Banner"),
                        m("button.btn.btn-primary#js_edit_banner_btn",{'type':"button",onclick: ctrl.mailer_banner_edit.bind(ctrl), 'style':'display:none;'},"Edit Banner"),                                          
                    ])
                ])
            ]),    
    ])};
    
    
    var bannertpl = function(modal_tpl){ return m(".js_banner_tpl", [    
        m("table.table.table-striped.table-bordered.table-hover#dataTable", [
            m("thead",[
                m("tr", [
                    m("th", "DAY"),
                    m("th", "IMG"),
                    m("th", "URL"),
                    m("th", "Active"),
                    m("th", "tpl"),
                    m("th", ""),
                ])
            ]),
            m("tbody",[
               ctrl.banners().map(function(data, index) {
                    var tpl_name = undefined;
                    if(data.tpl_id && data.tpl_id.name){
                        tpl_name = data.tpl_id.name;
                    }               
                    return m("tr",[
                         m("td", data.days),
                         m("td", data.img),
                         m("td", data.url),
                         m("td", data.active),
                         m("td", tpl_name),
                         m("td", [
                            m('button.btn',{id:data._id ,onclick: ctrl.set_banner_id.bind(ctrl),'data-toggle':"modal",href:"#ModalAddBanner"}, "edit"),
                            m('button.btn',{id:data._id ,onclick: ctrl.mailer_banner_del.bind(ctrl)}, "del")
                         ]),
                    ])
                })

                 
           ]),
            m("tfoot",[
                m("tr", [
                    m("th", "DAY"),
                    m("th", "IMG"),
                    m("th", "URL"),
                    m("th", "Active"),
                    m("th", "tpl"),
                    m("th", ""),
                ])
            ])                       
        ]),
        modal_tpl  ,
        m("button.btn.btn-primary#js_banner_btn", {'data-toggle':"modal",href:"#ModalAddBanner", onclick:function(){        $('#js_edit_banner_btn').css('display','none');   $('#js_add_banner_btn').css('display','block');}}, "Add"),
    ])
    };
    
  
    
    $('#js_main_tpl').css('display','block');
    $('#js_cpalab_title_tpl').css('display','none');
    $('.js_login_tpl').css('display','none');
    
    //console.log(rrr);
    return m.render(document.querySelector('div.js_content'), bannertpl(modal_add_banner_tpl()));   
    //*/
};


/************************************************/
var mailer_template = {};

mailer_template.tpls = function() { return m.request({method : "GET",url:'/mailer-tpl/'});};
mailer_template.get_lists = function() { return m.request({method : "POST",url:'/mailer-lists/'});};

mailer_template.getTpls = function(id){
    mailer_template.tpls().then(function( _tpls){
        var count =  _tpls.length;
        for(var i=0; i < count; i++){
            if(_tpls[i]._id === id){
                console.log(_tpls[i]);
                $('input#frommail').val(_tpls[i].frommail);
                $('select#list_id').val(_tpls[i].list_id);
                $('input#subject').val(_tpls[i].title);
                $('input#name').val(_tpls[i].name);
                $('textarea#tpl').val(_tpls[i].tpl);             
                return _tpls[i];
            }
        }
          
    });
}

mailer_template.controller = function(){
    var self = this;
    this.list= [];
    this.tpls = mailer_template.tpls();
    this.mailer_lists = mailer_template.get_lists();
    var serialize = function(obj) {
      var str = [];
      for(var p in obj)
        if (obj.hasOwnProperty(p)) {
          str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
        }
      return str.join("&");
    };     
    this.mailer_tpl_del = function(e){
        var id = e.target.id;
        $.post( "/mailer-tpl-del/", {tpl_id :id}, function( data ) {
          console.log(data);
          alert(JSON.stringify(data));
        }); 
    };
    this.mailer_tpl_add = function(){
        document.querySelector('#ModalAddEditTpl .modal-title').textContent = 'Add template';
        var form = document.querySelector('#ModalAddEditTpl');
        
        var formData = form2obj(form); 
          // console.log(formData);
        /*m.request({method : "POST",url:'/mailer-tpl-add/', data:formData }).then(function(data) {
            console.log(data);      
        });
       */
        $.post( "/mailer-tpl-add/", formData, function( data ) {
          console.log(data);
          alert(data);
        });       
        
    };
    
    this.mailer_tpl_edit = function(){
        var form = document.querySelector('#ModalAddEditTpl');
        var formData = form2obj(form);
        /*m.request({method : "POST",url:'/mailer-banner-edit/', data:formData }).then(function(data) {
            console.log(data); 
            alert(JSON.stringify(data));  
        });*/
        
        $.post( "/mailer-tpl-edit/", formData, function( data ) {
          console.log(data);
          alert(JSON.stringify(data));  
        })  
                  
    };
    
    this.set_tpl_id = function(e){
        document.querySelector('#ModalAddEditTpl .modal-title').textContent = 'Edit template';
        var tpl_id = e.target.id;
        document.querySelector('#tpl_id').value = tpl_id;
        mailer_template.getTpls(tpl_id);
        $('#js_edit_tpl_btn').css('display','block');
        $('#js_add_tpl_btn').css('display','none');
    };
    
};
mailer_template.view = function(ctrl){
    $('#heading > h1').text('Почтовые шаблоны');
    $('#js_main_tpl').css('display','block');
    $('#js_cpalab_title_tpl').css('display','none');
    $('.js_login_tpl').css('display','none');    
    var mtpl =   m(".js_mailer_template_tpl", [    
        m("table.table.table-striped.table-bordered.table-hover#dataTable", [
            m("thead",[
                m("tr", [
                    m("th", "frommail"),
                    m("th", "Название"),
                    m("th", "list_id"),
                    m("th", "Шаблон"),
                    m("th", "Тема"),
                    m("th"),
                ])
            ]),
            m("tbody",[
                ctrl.tpls().map(function(data, index) {
                    return m("tr", [
                        m("td", data.frommail),
                        m("td", data.name),
                        m("td", data.list_id),
                        m("td", data.tpl),
                        m("td", data.title),
                        m("td", [
                            m('button.btn',{id:data._id, onclick: ctrl.set_tpl_id.bind(ctrl), 'data-toggle':"modal", href:"#ModalAddEditTpl"}, "edit"),
                            m('button.btn',{id:data._id ,onclick: ctrl.mailer_tpl_del.bind(ctrl)}, "del")
                        ]),
                    ])
                })
             /*
                 m("td", data.name),
                 m("td", data.tpl),
                 m("td", data.subject),
             */
           ]),
            m("tfoot",[
                m("tr", [
                    m("th", "frommail"),
                    m("th", "Название"),
                    m("th", "list_id"),
                    m("th", "Шаблон"),
                    m("th", "Тема"),
                    m("th"),
                ])
            ])                       
        ]),
        m(".modal.fade#ModalAddEditTpl",{'tabindex':"-1",'role':"dialog",'aria-labelledby':"myModalLabel", 'aria-hidden':"true"},[
            m(".modal-dialog",[
                m(".modal-content",[
                    m(".modal-header",[
                        m(".close",{'data-dismiss':"modal", 'aria-hidden':"true"},"&times;"),
                        m(".modal-title",{},"Add template"),
                    ]),
                    m(".modal-body",[
                        m("input#tpl_id",{name:"tpl_id",type:'hidden'}),
                        m("select#list_id",{name:"list_id"},[
                            ctrl.mailer_lists().map(function(data, index) {
                                return m("option", {value:data.id},data.title);
                            })                               
                        ]),                        
                        m("br"),                 
                        m("div",[m("input#frommail",{name:"frommail",placeholder:"frommail",value:"horo@astrolog2u.ru"})]),
                        m("br"),                    
                        m("div",[m("input#subject",{name:"title",placeholder:"subject",value:""})]),
                        m("br"),
                        m("div",[m("input#name",{name:"name",placeholder:"name",value:""})]),
                        m("br"),
                        m("div",[m("textarea#tpl",{name:"tpl"})]),                        
                        m("br"),

                    ]),
                    m(".modal-footer",[
                        m("button.btn.btn-default",{'type':"button", 'data-dismiss':"modal"},"Close"),
                        m("button.btn.btn-primary#js_add_tpl_btn",{'type':"button",onclick: ctrl.mailer_tpl_add.bind(ctrl)},"Add Tpl"), 
                        m("button.btn.btn-primary#js_edit_tpl_btn",{'type':"button",onclick: ctrl.mailer_tpl_edit.bind(ctrl), 'style':'display:none;'},"Edit Tpl"),                    
                    ])
                ])
            ]),
        ]),         
        m("button.btn.btn-primary#js_mailer_tpl_btn", {'data-toggle':"modal",href:"#ModalAddEditTpl", onclick:function(){  $('#js_edit_tpl_btn').css('display','none');    $('#js_add_tpl_btn').css('display','block');}}, "Add"),

    ]);
    return m.render(document.querySelector('div.js_content'), mtpl); 
};


/******************************************************************/
var mailer_type ={};
mailer_type.controller = function(){};
mailer_type.view = function(ctrl){
    $('#heading > h1').text('Тип письма');
};
var mailer_api_key = {};
mailer_api_key.controller = function(){};
mailer_api_key.view = function(ctrl){
    $('#heading > h1').text('Ключи API');
    $('.js_content').html($('.js_mail_api_tpl').html());     
};
/**********************************************/
var main = {};
main.controller = function(){};
main.view = function(ctrl){
    $('#js_main_tpl').css('display','none');
    $('.js_login_tpl').css('display','none');
    $('#js_cpalab_title_tpl').css('display','block');
    return m.render(document.querySelector('#js_cpalab_title_tpl'),[ m("div#center", [    
        m("center", [
             m("div",{style:'font-size:50px;line-height:60px;'}, "CPALAB"),
             m("div", [
                m('a', {href:'#/login/'}, 'login')
             ]),                 
        ])
    ])]);
  
};
/**********************************************/
var statistics ={};
statistics.controller = function(){};
statistics.view = function(ctrl){
        $('#heading > h1').text('Statistics');
        var statistics_tpl = $('.js_statistics_tpl').html();
        $('.js_content').html(statistics_tpl);
        $('#js_main_tpl').css('display','block');
        $('#js_cpalab_title_tpl').css('display','none');
        $('.js_login_tpl').css('display','none');         
        
        
        $( ".js_content #tabs" ).tabs();
        $.get(server+'/statistics/', { }, function(data){
            console.log(data);
            var rep_counter = new _repeatable('.js_content #tbl_counter tbody');
            rep_counter.value = data.statistics_counter;
            var options = {
              valueNames: [ '_id', 'host', 'query', 'client_ip','unique_id','current_page','created_at','date' ],
              page: 15,
              plugins: [ ListPagination({}) ] 
            };
            var statList = new List('statlist', options);

            var rep_api = new _repeatable('.js_content #tbl_api tbody');
            rep_api.value = data.statistics_api;
                        
            var optionsapi = {
              valueNames: [ '_id', 'subaccount', 'payment', 'status','date' ],
              page: 15,
              plugins: [ ListPagination({}) ] 
            };           
             var statListApi = new List('statlistapi', optionsapi);
            
            var rep_merge = new _repeatable('.js_content #tbl_merge tbody');
            rep_merge.value = data.merge;            
            var statListApi = new List('statlistmerge', { 
                                valueNames: [  'subaccount', 'payment', 'status','host', 'query', 'client_ip','unique_id','current_page','created_at','date' ],
                                page: 15,
                                plugins: [ ListPagination({}) ] 
            });
            
            
            var btn = document.querySelectorAll('button');
            setEvent(btn);
                  
            //new Chartkick.PieChart("chart-2", obj2chart(groupData(obj2arr4key(data.merge,'host'))));
                          
        });         
};
/**********************************************/
var charts = {};
charts.controller = function(){};
charts.view = function(ctrl){
 $('#heading > h1').text('charts');
}

var icons = {};
icons.controller = function(){};
icons.view = function(ctrl){
 $('#heading > h1').text('icons');
}
/**********************************************/
m.route(document.body, "/", {
    "/": main ,
    "/login/": login,
    "/group-vk/": parser,
    "/parser-html-xml/": paesehtml,
    "/parser-rules/": parserules,
    "/dashboard/": dashboard,
    "/screenshot/" : screenshot,
    "/mailer/" : mailer,
    "/mailer_banner/" : mailer_banner,
    "/mailer_template/" : mailer_template,
    "/mailer_type/" : mailer_type,
    "/mailer_api_key/" : mailer_api_key,
    "/logout/" : logout,
    "/statistics/" : statistics,
    "/charts/" : charts,
    "/icons/" : icons,
});
m.route.mode = "hash";
 
    
    
/*******************************************/
/*
    Router.map("/statistics/", function() {
        $('#heading > h1').text('Statistics');
        var statistics_tpl = $('.js_statistics_tpl').html();
        $('.js_content').html(statistics_tpl);
        $( ".js_content #tabs" ).tabs();
        $.get(server+'/statistics/', { }, function(data){
            console.log(data);
            var rep_counter = new _repeatable('.js_content #tbl_counter tbody');
            rep_counter.value = data.statistics_counter;
            var options = {
              valueNames: [ '_id', 'host', 'query', 'client_ip','unique_id','current_page','created_at','date' ],
              page: 15,
              plugins: [ ListPagination({}) ] 
            };
            var statList = new List('statlist', options);

            var rep_api = new _repeatable('.js_content #tbl_api tbody');
            rep_api.value = data.statistics_api;
                        
            var optionsapi = {
              valueNames: [ '_id', 'subaccount', 'payment', 'status','date' ],
              page: 15,
              plugins: [ ListPagination({}) ] 
            };           
             var statListApi = new List('statlistapi', optionsapi);
            
            var rep_merge = new _repeatable('.js_content #tbl_merge tbody');
            rep_merge.value = data.merge;            
            var statListApi = new List('statlistmerge', { 
                                valueNames: [  'subaccount', 'payment', 'status','host', 'query', 'client_ip','unique_id','current_page','created_at','date' ],
                                page: 15,
                                plugins: [ ListPagination({}) ] 
            });
            
            
            var btn = document.querySelectorAll('button');
            setEvent(btn);
                  
            new Chartkick.PieChart("chart-2", obj2chart(groupData(obj2arr4key(data.merge,'host'))));
                          
        });         
    });
     
    Router.map("/screenshot/", function() {
        $('#heading > h1').text('ScreenShot');
        var screenshot_tpl = $('.js_screenshot_tpl').html();
        $('.js_content').html(screenshot_tpl);
        var btn = document.querySelectorAll('button');
        setEvent(btn);
    });
    
    *
    Router.map("charts", function() {
            $('#heading > h1').text('charts');
            $('.js_content').html('');
    });
    
/*    
    Router.map("/mailer/", function() {
            $('#heading > h1').text('Рассылки');
            $('.js_content').html($('.js_mailer_tpl').html());
            var rep_mailer = new _repeatable('.js_content tbody')
            rep_mailer.value = data_mailer;
            var rep_api = new _repeatable('.js_content #api_id')
            rep_api.value = data_mailer_api;
            //var rep_template = new _repeatable('.js_content #template_id')
            //rep_template.value = data_mailer_api;            
            
    });
    Router.map('/mailer_banner/', function() {
            $('#heading > h1').text('Рекламные блоки');
            $('.js_content').html('');
    });
    Router.map('/mailer_template/', function(){
            $('#heading > h1').text('Почтовые шаблоны');
    });
    Router.map('/mailer_type/' , function(){
            $('#heading > h1').text('Тип письма');
    });
    Router.map('/mailer_api_key/', function() {
            $('#heading > h1').text('Ключи API');
            $('.js_content').html($('.js_mail_api_tpl').html());
            
            
            var rep_api = new _repeatable('.js_content tbody')
            rep_api.value = data_mailer_api;
            var btn = document.querySelectorAll('button');
            setEvent(btn);

   });
*  
             
   Router.map( '/icons/', function() {
            $('#heading > h1').text('icons');
            $('.js_content').html('');
            var url = './tpl/icons.html';
            var iFame = makeIFrame(url);
            var con = iFame.contentWindow.document.body.innerHTML;
            console.log(con);
            //getFrameContents(iFame);
    });    
           
    
$(function(){
  Router.start();
});    
*/
    
/*
http://blog.byndyu.ru/2009/09/javascript.html
https://github.com/jgallen23/routie (http://projects.jga.me/routie/)
*

      routie({
        '': function() {
          Router.redirect('dashboard');
        },
/*       'login' : function(){
            $('#js_main_tpl').css('display','none');
            var login_tpl = $('#js_login_tpl').html();
            $('body').html(login_tpl);
        },
        'logout': function() {
                $.post(server+'/logout/', { }, function(data){
                    if(!data.isAuth){
                        Router.redirect('login');
                    }
                });  
        }, 
 *            
        'mailer': function() {
            $('#heading > h1').text('Рассылки');
            $('.js_content').html($('.js_mailer_tpl').html());
            var rep_mailer = new _repeatable('.js_content tbody')
            rep_mailer.value = data_mailer;
            var rep_api = new _repeatable('.js_content #api_id')
            rep_api.value = data_mailer_api;
            //var rep_template = new _repeatable('.js_content #template_id')
            //rep_template.value = data_mailer_api;            
            
        },
        'mailer_banner': function() {
            $('#heading > h1').text('Рекламные блоки');
            $('.js_content').html('');
        },
        'mailer_template' : function(){
            $('#heading > h1').text('Почтовые шаблоны');
        },  
        'mailer_type' : function(){
            $('#heading > h1').text('Тип письма');
        },       
        'mailer_api_key': function() {
            $('#heading > h1').text('Ключи API');
            $('.js_content').html($('.js_mail_api_tpl').html());
            
            
            var rep_api = new _repeatable('.js_content tbody')
            rep_api.value = data_mailer_api;
            var btn = document.querySelectorAll('button');
            setEvent(btn);

        },
        'icons': function() {
            $('#heading > h1').text('icons');
            $('.js_content').html('');
            var url = './tpl/icons.html';
            var iFame = makeIFrame(url);
            var con = iFame.contentWindow.document.body.innerHTML;
console.log(con);
            //getFrameContents(iFame);
        },        
                              
      });
 */ 
/*
var popup2 = new PopupMenu(document);
popup2.add('red', function(target) {
    target.style.background = 'red';
});
popup2.add('blue', function(target) {
    target.style.background = 'blue';
});
popup2.add('yellow', function(target) {
    target.style.background = 'yellow';
});
popup2.addSeparator();
popup2.add('default', function(target) {
    target.style.background = '#EEE';
})
popup2.setSize(150, 0);
popup2.bind(example2); 
*/

$('#js_reg').on('click',function(){
    var form = document.querySelector('#reg-form');
    var formData = form2obj(form);
	$.post( server+"/register/", formData, function( data ) {
        if(data.user ){
            //Router.redirect('dashboard');
            m.route("/login/");
        }
    });
});
    </script>   
    <script src="js/pages/login.js"></script>   
</html>
