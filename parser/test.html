<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/icon.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	
	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	
	<!-- http://jsfiddle.net/jcosnn6u/3/ -->
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
	<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
	
	<!-- https://select2.github.io/ -->
	<link href="js/select2/dist/css/select2.min.css" rel="stylesheet" />
	<script src="js/select2/dist/js/select2.min.js"></script>

	<!-- http://www.listjs.com/ -->
	<script type="text/javascript" src="js/list.js"></script>

	<!-- https://github.com/finom/vanillatree -->
	<link href="js/vanillatree/vanillatree.css" rel="stylesheet" />
	<script src="js/vanillatree/vanillatree.js"></script>
	
	<link  href="datepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
	<script src="datepicker/js/bootstrap-datetimepicker.min.js"></script>
	<script src="js/mithril.js"></script>
<script>
/*
//http://javascript.ru/forum/dom-window/21288-nuzhna-pomoshh-s-ochen-prostymi-veshhami-3.html
jQuery.ajax = function (d) {
    var b = location.protocol,
        e = RegExp(b + "//" + location.hostname),
        f = "http" + (/^https/.test(b) ? "s" : "") + "://query.yahooapis.com/v1/public/yql?callback=?";
    return function (a) {
        var c = a.url;
        if (/get/i.test(a.type) && !/json/i.test(a.dataType) && !e.test(c) && /:\/\//.test(c)) {
            a.url = f;
            a.dataType = "json";
            a.data = {
                q: 'select * from html where url="{URL}" and xpath="*"'.replace("{URL}", c + (a.data ? (/\?/.test(c) ? "&" : "?") + jQuery.param(a.data) : "")),
                format: "xml"
            };
            !a.success && a.complete && (a.success = a.complete, delete a.complete);
            var b = a.success;
            a.success = function (a) {
                b && b.call(this, {
                    responseText: (a.results[0] || "").replace(/<script[^>]+?\/>|<script(.|\s)*?\/script>/gi, "")
                }, "success")
            }
        }
        return d.apply(this, arguments)
    }
}(jQuery.ajax);
*/

function addScript(el,url,param){
	param = param || "";
	var script = el.createElement("script");
	script.src = url+'/'+param;
	script.async = true;
	el.getElementsByTagName("head")[0].appendChild(script);
};

var jsonp_set_html = function(data) {
	_PARSE.golink = false;
	console.log(data);
	var html = populateIframe('html', data.res);
	setEvenHoveredAll(html);
	removeClass(document.querySelector('#golink'),'active');
	Loading.close();
};
	
function request(url,callback) {
	Loading.show();
	callback = callback||null;
	if(callback === null){
		callback = function(res) {
			_PARSE.golink = false;
			var html = populateIframe('html', res.responseText);
			setEvenHoveredAll(html);
			removeClass(document.querySelector('#golink'),'active');
			Loading.close();
		};
	}
	/*
	$.ajax({
		url: url,
		type: 'GET',
		success: callback
	});
	*/
	addScript(document,'https://peaceful-retreat-5894.herokuapp.com/get-content/habrahabr.ru','?jsonp_callback=jsonp_set_html');

}	

</script>

<style>
#htmltree-content {
	margin-bottom: 10px;
	border: 1px solid #DDDDDD;
	overflow: auto;
	height: 69%;
	width: 98%;
}

#htmltree-content ul {
	list-style: none;
}

#htmltree-content .plus {
	margin-right: 5px;
}

#htmltree-content li {
	cursor: pointer;
}

#htmltree-content .selected {
	background: black;
	color: white;
}

</style>
  </head>
  <body>
<template id="js_parser_list">
				<div id="parser_list" class="grid-view">
					<input type="text" class="search" placeholder="Search" />
					<ul class="head_list">
							<li class="">
								<span class="sort col_5" data-sort="name" id="yw0_c1"><a >id<span class="caret"></span></a></span>
								<span class="sort col_5" data-sort="name" id="yw0_c1"><a >Название сайта<span class="caret"></span></a></span>
								<span class="sort col_5" data-sort="url"  id="yw0_c2"><a >URL сайта<span class="caret"></span></a></span>
								<span class="sort col_5" data-sort="date_edit" id="yw0_c3"><a>Изменено<span class="caret"></span></a></span>
								<span class="button-column col_5" id="yw0_c4"> </span>
							</li>
					</ul>
					<ul class="list"></ul>
				</div>
<script>
	var initParseList = function (){
			//http://www.listjs.com/examples/add-get-remove
			var ParseOptions = {
				valueNames: ['id','name', 'url', 'date_edit' ],
				item: '<li class="">'+
								'<span class="id col_5" id="yw0_c1"><a><span class="caret"></span></a></span>'+
								'<span class="name col_5" id="yw0_c1"><a><span class="caret"></span></a></span>'+
								'<span class="url col_5" id="yw0_c2"><a><span class="caret"></span></a></span>'+
								'<span class="date_edit col_5" id="yw0_c3"><a><span class="caret"></span></a></span>'+
								'<span class="button-column col_5" id="yw0_c4">'+ 
											'<button style="margin-left: 5px;" data-toggle="modal" data-target="#editParseModal" data-target=".bs-example-modal-lg" class="edit" rel="tooltip" data-original-title="Редактировать"><i class="icon-edit"></i></button>'+
											'<button style="margin-left: 5px;" data-toggle="modal" data-target="#settingParseModal" rel="tooltip" data-original-title="Генерировать"><i class="icon-file"></i></button>'+
											'<button style="margin-left: 5px;" data-toggle="modal" data-target="#runParseModal" rel="tooltip"  data-original-title="Управление запуском"><i class="icon-play"></i></button>'+
											'<button style="margin-left: 5px;" data-toggle="modal" data-target="#resultParseModal" rel="tooltip"  data-original-title="Результат выполнения"><i class="icon-folder-open"></i></button>'+
											'<button style="margin-left: 5px;" data-toggle="modal" data-target="#deleteParseModal" rel="tooltip" data-original-title="Create" rel="tooltip"  data-original-title="Удалить"><i class="icon-remove"></i></button>'+
								'</span>'+
						'</li>'
			};
			// Init list
			return new List('parser_list', ParseOptions);
	}
	var parseList = initParseList();
	
	function getParserData(){
		return [
			{'id':'1', 'name':'habrahabr.ru','url':'http://habrahabr.ru/','date_edit':'22.05.2015'},
			{'id':'2', 'name':'test','url':'http://test.te','date_edit':'22.05.2015'}
		]
	}
	function addParseList(){
		var parser = getParserData();
		parseList.add(parser);
	}
	addParseList();    
</script>				
</template>
<div id="main">
	<div id="header">
	<div class="container-fluid">
		<div id="userinfo">
			<!--prio@hotbox.ru&nbsp;&nbsp;|&nbsp;&nbsp;<a target="_blank" href="#/ru/docs">Документация</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="#/ru/site/logout">Выход</a>	-->	
		</div>
		<div id="logo">
			<a href="/">
				<h1>Parser</h1>
			</a>
		</div>
	</div>	
	</div><!-- header -->
</div>	
<div class="clear"></div>

<!-- PARSER LIST -->
<div class="container-fluid">
	<div id="js_block">

	</div>
</div>
	
<div class="clear"></div>





<script>

var Home = {
    controller: function() {

        return {
            onunload: function() {
                console.log("unloading home component");
            }
        };
    },
    view: function() {
		var host = document.querySelector('#js_block');
		var template = document.querySelector('#js_parser_list');
		var clone = document.importNode(template.content, true);
		document.querySelector('#js_block').appendChild(clone);          	
          	
          	alert('xxx');
          	return ;
      		//shadow.appendChild(template.content);
        //return m("div", m.trust(document.querySelector('#js_parser_list').innerHTML))
    }
};

var Dashboard = {
    controller: function() {},
    view: function() {}
};

//m.route.mode = "hash";
//m.route.mode = "search";
//go to the default route (home)
/*
m.route(document.querySelector('#js_block'), "/", {
    "/": Home,
    "/dashboard": Dashboard,
});
*/
//re-route to dashboard
//m.route("/dashboard"); // logs "unloading home"
</script>
  </body>
</html>
